"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _observable = require("@atom-ide-community/nuclide-commons/observable");

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var React = _interopRequireWildcard(require("react"));

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

var _FilterReminder = _interopRequireDefault(require("@atom-ide-community/nuclide-commons-ui/FilterReminder"));

var _OutputTable = _interopRequireDefault(require("./OutputTable"));

var _ConsoleHeader = _interopRequireDefault(require("./ConsoleHeader"));

var _InputArea = _interopRequireDefault(require("./InputArea"));

var _PromptButton = _interopRequireDefault(require("./PromptButton"));

var _NewMessagesNotification = _interopRequireDefault(require("./NewMessagesNotification"));

var _assert = _interopRequireDefault(require("assert"));

var _nullthrows = _interopRequireDefault(require("nullthrows"));

var _shallowequal = _interopRequireDefault(require("shallowequal"));

var _recordsChanged = _interopRequireDefault(require("../recordsChanged"));

var _StyleSheet = _interopRequireDefault(require("@atom-ide-community/nuclide-commons-ui/StyleSheet"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
// Maximum time (ms) for the console to try scrolling to the bottom.
const MAXIMUM_SCROLLING_TIME = 3000;
const DEFAULT_SCOPE_NAME = 'text.plain';
let count = 0;

class ConsoleView extends React.Component {
  // Used when _scrollToBottom is called. The console optimizes message loading
  // so scrolling to the bottom once doesn't always scroll to the bottom since
  // more messages can be loaded after.
  constructor(props) {
    super(props);
    this._consoleScrollPaneEl = void 0;
    this._consoleHeaderComponent = void 0;
    this._disposables = void 0;
    this._executorScopeDisposables = void 0;
    this._isScrolledNearBottom = void 0;
    this._id = void 0;
    this._inputArea = void 0;
    this._continuouslyScrollToBottom = void 0;
    this._scrollingThrottle = void 0;
    this._outputTable = void 0;

    this._getExecutor = id => {
      return this.props.executors.get(id);
    };

    this._getProvider = id => {
      return this.props.getProvider(id);
    };

    this._executePrompt = code => {
      this.props.execute(code); // Makes the console to scroll to the bottom.

      this._isScrolledNearBottom = true;
    };

    this._handleScroll = (offsetHeight, scrollHeight, scrollTop) => {
      this._handleScrollEnd(offsetHeight, scrollHeight, scrollTop);
    };

    this._handleOutputTable = ref => {
      this._outputTable = ref;
    };

    this._scrollToBottom = () => {
      if (!this._outputTable) {
        return;
      }

      this._outputTable.scrollToBottom();

      this.setState({
        unseenMessages: false
      });
    };

    this._startScrollToBottom = () => {
      if (!this._continuouslyScrollToBottom) {
        this._continuouslyScrollToBottom = true;
        this._scrollingThrottle = _rxjsCompatUmdMin.Observable.timer(MAXIMUM_SCROLLING_TIME).subscribe(() => {
          this._stopScrollToBottom();
        });
      }

      this._scrollToBottom();
    };

    this._stopScrollToBottom = () => {
      this._continuouslyScrollToBottom = false;

      if (this._scrollingThrottle != null) {
        this._scrollingThrottle.unsubscribe();
      }
    };

    this._shouldScrollToBottom = () => {
      return this._isScrolledNearBottom || this._continuouslyScrollToBottom;
    };

    this.state = {
      unseenMessages: false,
      scopeName: DEFAULT_SCOPE_NAME
    };
    this._disposables = new _UniversalDisposable.default();
    this._executorScopeDisposables = new _UniversalDisposable.default();
    this._isScrolledNearBottom = true;
    this._continuouslyScrollToBottom = false;
    this._id = count++;
  }

  componentDidMount() {
    this._disposables.add( // Wait for `<OutputTable />` to render itself via react-virtualized before scrolling and
    // re-measuring; Otherwise, the scrolled location will be inaccurate, preventing the Console
    // from auto-scrolling.
    _observable.macrotask.subscribe(() => {
      this._startScrollToBottom();
    }), () => {
      if (this._scrollingThrottle != null) {
        this._scrollingThrottle.unsubscribe();
      }
    }, atom.commands.add('atom-workspace', {
      // eslint-disable-next-line nuclide-internal/atom-apis
      'atom-ide-console:focus-console-prompt': () => {
        if (this._inputArea != null) {
          this._inputArea.focus();
        }
      }
    }), atom.commands.add('atom-workspace', {
      // eslint-disable-next-line nuclide-internal/atom-apis
      'atom-ide-console:scroll-to-bottom': () => {
        this._scrollToBottom();
      }
    }), atom.commands.add((0, _nullthrows.default)(this._consoleScrollPaneEl), 'atom-ide:filter', () => this._focusFilter()));
  }

  componentWillUnmount() {
    this._disposables.dispose();

    this._executorScopeDisposables.dispose();
  }

  componentDidUpdate(prevProps) {
    // If records are added while we're scrolled to the bottom (or very very close, at least),
    // automatically scroll.
    if (this._isScrolledNearBottom && (0, _recordsChanged.default)(prevProps.records, this.props.records)) {
      this._startScrollToBottom();
    }
  }

  _focusFilter() {
    if (this._consoleHeaderComponent != null) {
      this._consoleHeaderComponent.focusFilter();
    }
  }

  _renderPromptButton() {
    (0, _assert.default)(this.props.currentExecutor != null);
    const {
      currentExecutor
    } = this.props;
    const options = Array.from(this.props.executors.values()).map(executor => ({
      id: executor.id,
      label: executor.name
    }));
    return /*#__PURE__*/React.createElement(_PromptButton.default, {
      value: currentExecutor.id,
      onChange: this.props.selectExecutor,
      options: options,
      children: currentExecutor.name
    });
  }

  _isScrolledToBottom(offsetHeight, scrollHeight, scrollTop) {
    return scrollHeight - (offsetHeight + scrollTop) < 5;
  }

  UNSAFE_componentWillReceiveProps(nextProps) {
    // If the messages were cleared, hide the notification.
    if (nextProps.records.length === 0) {
      this._isScrolledNearBottom = true;
      this.setState({
        unseenMessages: false
      });
    } else if ( // If we receive new messages after we've scrolled away from the bottom, show the "new
    // messages" notification.
    !this._isScrolledNearBottom && (0, _recordsChanged.default)(this.props.records, nextProps.records)) {
      this.setState({
        unseenMessages: true
      });
    }

    this._executorScopeDisposables.dispose();

    this._executorScopeDisposables = new _UniversalDisposable.default();

    for (const executor of nextProps.executors.values()) {
      if (executor != null && executor.onDidChangeScopeName != null) {
        this._executorScopeDisposables.add(executor.onDidChangeScopeName(() => {
          const scopeName = executor.scopeName();
          this.setState({
            scopeName
          });
        }));
      }
    }
  }

  shouldComponentUpdate(nextProps, nextState) {
    return !(0, _shallowequal.default)(this.props, nextProps) || !(0, _shallowequal.default)(this.state, nextState);
  }

  render() {
    return /*#__PURE__*/React.createElement("div", {
      className: "console"
    }, /*#__PURE__*/React.createElement(_StyleSheet.default, {
      sourcePath: "console-font-style",
      priority: -1,
      css: `
            #console-font-size-${this._id} {
              font-size: ${this.props.fontSize}px;
            }
          `
    }), /*#__PURE__*/React.createElement(_ConsoleHeader.default, {
      clear: this.props.clearRecords,
      createPaste: this.props.createPaste,
      invalidFilterInput: this.props.invalidFilterInput,
      enableRegExpFilter: this.props.enableRegExpFilter,
      filterText: this.props.filterText,
      ref: component => this._consoleHeaderComponent = component,
      selectedSourceIds: this.props.selectedSourceIds,
      sources: this.props.sources,
      onFilterChange: this.props.updateFilter,
      onSelectedSourcesChange: this.props.selectSources,
      selectedSeverities: this.props.selectedSeverities,
      toggleSeverity: this.props.toggleSeverity
    }), /*#__PURE__*/React.createElement("div", {
      className: "console-body",
      id: 'console-font-size-' + this._id
    }, /*#__PURE__*/React.createElement("div", {
      className: "console-scroll-pane-wrapper atom-ide-filterable",
      ref: el => this._consoleScrollPaneEl = el
    }, /*#__PURE__*/React.createElement(_FilterReminder.default, {
      noun: "message",
      nounPlural: "messages",
      filteredRecordCount: this.props.filteredRecordCount,
      onReset: this.props.resetAllFilters
    }), /*#__PURE__*/React.createElement(_OutputTable.default // $FlowFixMe(>=0.53.0) Flow suppress
    , {
      ref: this._handleOutputTable,
      records: this.props.records,
      showSourceLabels: this.props.selectedSourceIds.length > 1,
      fontSize: this.props.fontSize,
      getExecutor: this._getExecutor,
      getProvider: this._getProvider,
      onScroll: this._handleScroll,
      shouldScrollToBottom: this._shouldScrollToBottom
    }), /*#__PURE__*/React.createElement(_NewMessagesNotification.default, {
      visible: this.state.unseenMessages,
      onClick: this._startScrollToBottom
    })), this._renderPrompt()));
  }

  _getMultiLineTip() {
    const {
      currentExecutor
    } = this.props;

    if (currentExecutor == null) {
      return '';
    }

    const keyCombo = process.platform === 'darwin' ? // Option + Enter on Mac
    '\u2325  + \u23CE' : // Shift + Enter on Windows and Linux.
    'Shift + Enter';
    return `Tip: ${keyCombo} to insert a newline`;
  }

  _renderPrompt() {
    const {
      currentExecutor
    } = this.props;

    if (currentExecutor == null) {
      return;
    }

    return /*#__PURE__*/React.createElement("div", {
      className: "console-prompt"
    }, this._renderPromptButton(), /*#__PURE__*/React.createElement(_InputArea.default, {
      ref: component => this._inputArea = component,
      scopeName: this.state.scopeName,
      fontSize: this.props.fontSize,
      onSubmit: this._executePrompt,
      history: this.props.history,
      watchEditor: this.props.watchEditor,
      placeholderText: this._getMultiLineTip()
    }));
  }

  _handleScrollEnd(offsetHeight, scrollHeight, scrollTop) {
    const isScrolledToBottom = this._isScrolledToBottom(offsetHeight, scrollHeight, scrollTop);

    this._isScrolledNearBottom = isScrolledToBottom;

    this._stopScrollToBottom();

    this.setState({
      // TODO: (wbinnssmith) T30771435 this setState depends on current state
      // and should use an updater function rather than an object
      // eslint-disable-next-line react/no-access-state-in-setstate
      unseenMessages: this.state.unseenMessages && !this._isScrolledNearBottom
    });
  }

}

exports.default = ConsoleView;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbnNvbGVWaWV3LmpzIl0sIm5hbWVzIjpbIk1BWElNVU1fU0NST0xMSU5HX1RJTUUiLCJERUZBVUxUX1NDT1BFX05BTUUiLCJjb3VudCIsIkNvbnNvbGVWaWV3IiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiX2NvbnNvbGVTY3JvbGxQYW5lRWwiLCJfY29uc29sZUhlYWRlckNvbXBvbmVudCIsIl9kaXNwb3NhYmxlcyIsIl9leGVjdXRvclNjb3BlRGlzcG9zYWJsZXMiLCJfaXNTY3JvbGxlZE5lYXJCb3R0b20iLCJfaWQiLCJfaW5wdXRBcmVhIiwiX2NvbnRpbnVvdXNseVNjcm9sbFRvQm90dG9tIiwiX3Njcm9sbGluZ1Rocm90dGxlIiwiX291dHB1dFRhYmxlIiwiX2dldEV4ZWN1dG9yIiwiaWQiLCJleGVjdXRvcnMiLCJnZXQiLCJfZ2V0UHJvdmlkZXIiLCJnZXRQcm92aWRlciIsIl9leGVjdXRlUHJvbXB0IiwiY29kZSIsImV4ZWN1dGUiLCJfaGFuZGxlU2Nyb2xsIiwib2Zmc2V0SGVpZ2h0Iiwic2Nyb2xsSGVpZ2h0Iiwic2Nyb2xsVG9wIiwiX2hhbmRsZVNjcm9sbEVuZCIsIl9oYW5kbGVPdXRwdXRUYWJsZSIsInJlZiIsIl9zY3JvbGxUb0JvdHRvbSIsInNjcm9sbFRvQm90dG9tIiwic2V0U3RhdGUiLCJ1bnNlZW5NZXNzYWdlcyIsIl9zdGFydFNjcm9sbFRvQm90dG9tIiwiT2JzZXJ2YWJsZSIsInRpbWVyIiwic3Vic2NyaWJlIiwiX3N0b3BTY3JvbGxUb0JvdHRvbSIsInVuc3Vic2NyaWJlIiwiX3Nob3VsZFNjcm9sbFRvQm90dG9tIiwic3RhdGUiLCJzY29wZU5hbWUiLCJVbml2ZXJzYWxEaXNwb3NhYmxlIiwiY29tcG9uZW50RGlkTW91bnQiLCJhZGQiLCJtYWNyb3Rhc2siLCJhdG9tIiwiY29tbWFuZHMiLCJmb2N1cyIsIl9mb2N1c0ZpbHRlciIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGlzcG9zZSIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsInJlY29yZHMiLCJmb2N1c0ZpbHRlciIsIl9yZW5kZXJQcm9tcHRCdXR0b24iLCJjdXJyZW50RXhlY3V0b3IiLCJvcHRpb25zIiwiQXJyYXkiLCJmcm9tIiwidmFsdWVzIiwibWFwIiwiZXhlY3V0b3IiLCJsYWJlbCIsIm5hbWUiLCJzZWxlY3RFeGVjdXRvciIsIl9pc1Njcm9sbGVkVG9Cb3R0b20iLCJVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsIm5leHRQcm9wcyIsImxlbmd0aCIsIm9uRGlkQ2hhbmdlU2NvcGVOYW1lIiwic2hvdWxkQ29tcG9uZW50VXBkYXRlIiwibmV4dFN0YXRlIiwicmVuZGVyIiwiZm9udFNpemUiLCJjbGVhclJlY29yZHMiLCJjcmVhdGVQYXN0ZSIsImludmFsaWRGaWx0ZXJJbnB1dCIsImVuYWJsZVJlZ0V4cEZpbHRlciIsImZpbHRlclRleHQiLCJjb21wb25lbnQiLCJzZWxlY3RlZFNvdXJjZUlkcyIsInNvdXJjZXMiLCJ1cGRhdGVGaWx0ZXIiLCJzZWxlY3RTb3VyY2VzIiwic2VsZWN0ZWRTZXZlcml0aWVzIiwidG9nZ2xlU2V2ZXJpdHkiLCJlbCIsImZpbHRlcmVkUmVjb3JkQ291bnQiLCJyZXNldEFsbEZpbHRlcnMiLCJfcmVuZGVyUHJvbXB0IiwiX2dldE11bHRpTGluZVRpcCIsImtleUNvbWJvIiwicHJvY2VzcyIsInBsYXRmb3JtIiwiaGlzdG9yeSIsIndhdGNoRWRpdG9yIiwiaXNTY3JvbGxlZFRvQm90dG9tIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBZUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBN0JBOzs7Ozs7Ozs7OztBQTZEQTtBQUNBLE1BQU1BLHNCQUFzQixHQUFHLElBQS9CO0FBQ0EsTUFBTUMsa0JBQWtCLEdBQUcsWUFBM0I7QUFFQSxJQUFJQyxLQUFL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R0FBd0I7QUFDbkMsVUFBTTtBQUFDbEMsTUFBQUE7QUFBRCxRQUFvQixLQUFLdkQsS0FBL0I7O0FBQ0EsUUFBSXVELGVBQWUsSUFBSSxJQUF2QixFQUE2QjtBQUMzQjtBQUNEOztBQUNELHdCQUNFO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUNHLEtBQUtELG1CQUFMLEVBREgsZUFFRSxvQkFBQyxrQkFBRDtBQUNFLE1BQUEsR0FBRyxFQUFHeUIsU0FBRCxJQUE0QixLQUFLeEUsVUFBTCxHQUFrQndFLFNBRHJEO0FBRUUsTUFBQSxTQUFTLEVBQUUsS0FBS3pDLEtBQUwsQ0FBV0MsU0FGeEI7QUFHRSxNQUFBLFFBQVEsRUFBRSxLQUFLdkMsS0FBTCxDQUFXeUUsUUFIdkI7QUFJRSxNQUFBLFFBQVEsRUFBRSxLQUFLeEQsY0FKakI7QUFLRSxNQUFBLE9BQU8sRUFBRSxLQUFLakIsS0FBTCxDQUFXOEYsT0FMdEI7QUFNRSxNQUFBLFdBQVcsRUFBRSxLQUFLOUYsS0FBTCxDQUFXK0YsV0FOMUI7QUFPRSxNQUFBLGVBQWUsRUFBRSxLQUFLTCxnQkFBTDtBQVBuQixNQUZGLENBREY7QUFjRDs7QUFnQkRsRSxFQUFBQSxnQkFBZ0IsQ0FDZEgsWUFEYyxFQUVkQyxZQUZjLEVBR2RDLFNBSGMsRUFJUjtBQUNOLFVBQU15RSxrQkFBa0IsR0FBRyxLQUFLL0IsbUJBQUwsQ0FDekI1QyxZQUR5QixFQUV6QkMsWUFGeUIsRUFHekJDLFNBSHlCLENBQTNCOztBQU1BLFNBQUtsQixxQkFBTCxHQUE2QjJGLGtCQUE3Qjs7QUFDQSxTQUFLN0QsbUJBQUw7O0FBQ0EsU0FBS04sUUFBTCxDQUFjO0FBQ1o7QUFDQTtBQUNBO0FBQ0FDLE1BQUFBLGNBQWMsRUFBRSxLQUFLUSxLQUFMLENBQVdSLGNBQVgsSUFBNkIsQ0FBQyxLQUFLekI7QUFKdkMsS0FBZDtBQU1EOztBQWxTb0UiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQgdHlwZSB7RXhlY3V0b3IsIFNldmVyaXR5LCBSZWNvcmQsIFNvdXJjZSwgU291cmNlSW5mb30gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHR5cGUge1JlZ0V4cEZpbHRlckNoYW5nZX0gZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMtdWkvUmVnRXhwRmlsdGVyJztcblxuaW1wb3J0IHttYWNyb3Rhc2t9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL29ic2VydmFibGUnO1xuaW1wb3J0IFVuaXZlcnNhbERpc3Bvc2FibGUgZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvVW5pdmVyc2FsRGlzcG9zYWJsZSc7XG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMtY29tcGF0L2J1bmRsZXMvcnhqcy1jb21wYXQudW1kLm1pbi5qcyc7XG5pbXBvcnQgRmlsdGVyUmVtaW5kZXIgZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMtdWkvRmlsdGVyUmVtaW5kZXInO1xuaW1wb3J0IE91dHB1dFRhYmxlIGZyb20gJy4vT3V0cHV0VGFibGUnO1xuaW1wb3J0IENvbnNvbGVIZWFkZXIgZnJvbSAnLi9Db25zb2xlSGVhZGVyJztcbmltcG9ydCBJbnB1dEFyZWEgZnJvbSAnLi9JbnB1dEFyZWEnO1xuaW1wb3J0IFByb21wdEJ1dHRvbiBmcm9tICcuL1Byb21wdEJ1dHRvbic7XG5pbXBvcnQgTmV3TWVzc2FnZXNOb3RpZmljYXRpb24gZnJvbSAnLi9OZXdNZXNzYWdlc05vdGlmaWNhdGlvbic7XG5pbXBvcnQgaW52YXJpYW50IGZyb20gJ2Fzc2VydCc7XG5pbXBvcnQgbnVsbHRocm93cyBmcm9tICdudWxsdGhyb3dzJztcbmltcG9ydCBzaGFsbG93RXF1YWwgZnJvbSAnc2hhbGxvd2VxdWFsJztcbmltcG9ydCByZWNvcmRzQ2hhbmdlZCBmcm9tICcuLi9yZWNvcmRzQ2hhbmdlZCc7XG5pbXBvcnQgU3R5bGVTaGVldCBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aS9TdHlsZVNoZWV0JztcblxudHlwZSBQcm9wcyA9IHt8XG4gIHJlY29yZHM6IEFycmF5PFJlY29yZD4sXG4gIGhpc3Rvcnk6IEFycmF5PHN0cmluZz4sXG4gIGNsZWFyUmVjb3JkczogKCkgPT4gdm9pZCxcbiAgY3JlYXRlUGFzdGU6ID8oKSA9PiBQcm9taXNlPHZvaWQ+LFxuICB3YXRjaEVkaXRvcjogP2F0b20kQXV0b2NvbXBsZXRlV2F0Y2hFZGl0b3IsXG4gIGV4ZWN1dGU6IChjb2RlOiBzdHJpbmcpID0+IHZvaWQsXG4gIGN1cnJlbnRFeGVjdXRvcjogP0V4ZWN1dG9yLFxuICBleGVjdXRvcnM6IE1hcDxzdHJpbmcsIEV4ZWN1dG9yPixcbiAgaW52YWxpZEZpbHRlcklucHV0OiBib29sZWFuLFxuICBlbmFibGVSZWdFeHBGaWx0ZXI6IGJvb2xlYW4sXG4gIHNlbGVjdGVkU291cmNlSWRzOiBBcnJheTxzdHJpbmc+LFxuICBzZWxlY3RFeGVjdXRvcjogKGV4ZWN1dG9ySWQ6IHN0cmluZykgPT4gdm9pZCxcbiAgc2VsZWN0U291cmNlczogKHNvdXJjZUlkczogQXJyYXk8c3RyaW5nPikgPT4gdm9pZCxcbiAgc291cmNlczogQXJyYXk8U291cmNlPixcbiAgdXBkYXRlRmlsdGVyOiAoY2hhbmdlOiBSZWdFeHBGaWx0ZXJDaGFuZ2UpID0+IHZvaWQsXG4gIGdldFByb3ZpZGVyOiAoaWQ6IHN0cmluZykgPT4gP1NvdXJjZUluZm8sXG4gIGZpbHRlcmVkUmVjb3JkQ291bnQ6IG51bWJlcixcbiAgZmlsdGVyVGV4dDogc3RyaW5nLFxuICByZXNldEFsbEZpbHRlcnM6ICgpID0+IHZvaWQsXG4gIGZvbnRTaXplOiBudW1iZXIsXG4gIHNlbGVjdGVkU2V2ZXJpdGllczogU2V0PFNldmVyaXR5PixcbiAgdG9nZ2xlU2V2ZXJpdHk6IChzZXZlcml0eTogU2V2ZXJpdHkpID0+IHZvaWQsXG58fTtcblxudHlwZSBTdGF0ZSA9IHtcbiAgdW5zZWVuTWVzc2FnZXM6IGJvb2xlYW4sXG4gIHNjb3BlTmFtZTogc3RyaW5nLFxufTtcblxuLy8gTWF4aW11bSB0aW1lIChtcykgZm9yIHRoZSBjb25zb2xlIHRvIHRyeSBzY3JvbGxpbmcgdG8gdGhlIGJvdHRvbS5cbmNvbnN0IE1BWElNVU1fU0NST0xMSU5HX1RJTUUgPSAzMDAwO1xuY29uc3QgREVGQVVMVF9TQ09QRV9OQU1FID0gJ3RleHQucGxhaW4nO1xuXG5sZXQgY291bnQgPSAwO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb25zb2xlVmlldyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcbiAgX2NvbnNvbGVTY3JvbGxQYW5lRWw6ID9IVE1MRGl2RWxlbWVudDtcbiAgX2NvbnNvbGVIZWFkZXJDb21wb25lbnQ6ID9Db25zb2xlSGVhZGVyO1xuICBfZGlzcG9zYWJsZXM6IFVuaXZlcnNhbERpc3Bvc2FibGU7XG4gIF9leGVjdXRvclNjb3BlRGlzcG9zYWJsZXM6IFVuaXZlcnNhbERpc3Bvc2FibGU7XG4gIF9pc1Njcm9sbGVkTmVhckJvdHRvbTogYm9vbGVhbjtcbiAgX2lkOiBudW1iZXI7XG4gIF9pbnB1dEFyZWE6ID9JbnB1dEFyZWE7XG5cbiAgLy8gVXNlZCB3aGVuIF9zY3JvbGxUb0JvdHRvbSBpcyBjYWxsZWQuIFRoZSBjb25zb2xlIG9wdGltaXplcyBtZXNzYWdlIGxvYWRpbmdcbiAgLy8gc28gc2Nyb2xsaW5nIHRvIHRoZSBib3R0b20gb25jZSBkb2Vzbid0IGFsd2F5cyBzY3JvbGwgdG8gdGhlIGJvdHRvbSBzaW5jZVxuICAvLyBtb3JlIG1lc3NhZ2VzIGNhbiBiZSBsb2FkZWQgYWZ0ZXIuXG4gIF9jb250aW51b3VzbHlTY3JvbGxUb0JvdHRvbTogYm9vbGVhbjtcbiAgX3Njcm9sbGluZ1Rocm90dGxlOiA/cnhqcyRTdWJzY3JpcHRpb247XG5cbiAgX291dHB1dFRhYmxlOiA/T3V0cHV0VGFibGU7XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICB1bnNlZW5NZXNzYWdlczogZmFsc2UsXG4gICAgICBzY29wZU5hbWU6IERFRkFVTFRfU0NPUEVfTkFNRSxcbiAgICB9O1xuICAgIHRoaXMuX2Rpc3Bvc2FibGVzID0gbmV3IFVuaXZlcnNhbERpc3Bvc2FibGUoKTtcbiAgICB0aGlzLl9leGVjdXRvclNjb3BlRGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZSgpO1xuICAgIHRoaXMuX2lzU2Nyb2xsZWROZWFyQm90dG9tID0gdHJ1ZTtcbiAgICB0aGlzLl9jb250aW51b3VzbHlTY3JvbGxUb0JvdHRvbSA9IGZhbHNlO1xuICAgIHRoaXMuX2lkID0gY291bnQrKztcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xuICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmFkZChcbiAgICAgIC8vIFdhaXQgZm9yIGA8T3V0cHV0VGFibGUgLz5gIHRvIHJlbmRlciBpdHNlbGYgdmlhIHJlYWN0LXZpcnR1YWxpemVkIGJlZm9yZSBzY3JvbGxpbmcgYW5kXG4gICAgICAvLyByZS1tZWFzdXJpbmc7IE90aGVyd2lzZSwgdGhlIHNjcm9sbGVkIGxvY2F0aW9uIHdpbGwgYmUgaW5hY2N1cmF0ZSwgcHJldmVudGluZyB0aGUgQ29uc29sZVxuICAgICAgLy8gZnJvbSBhdXRvLXNjcm9sbGluZy5cbiAgICAgIG1hY3JvdGFzay5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLl9zdGFydFNjcm9sbFRvQm90dG9tKCk7XG4gICAgICB9KSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuX3Njcm9sbGluZ1Rocm90dGxlICE9IG51bGwpIHtcbiAgICAgICAgICB0aGlzLl9zY3JvbGxpbmdUaHJvdHRsZS51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYXRvbS5jb21tYW5kcy5hZGQoJ2F0b20td29ya3NwYWNlJywge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbnVjbGlkZS1pbnRlcm5hbC9hdG9tLWFwaXNcbiAgICAgICAgJ2F0b20taWRlLWNvbnNvbGU6Zm9jdXMtY29uc29sZS1wcm9tcHQnOiAoKSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuX2lucHV0QXJlYSAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLl9pbnB1dEFyZWEuZm9jdXMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICAgIGF0b20uY29tbWFuZHMuYWRkKCdhdG9tLXdvcmtzcGFjZScsIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG51Y2xpZGUtaW50ZXJuYWwvYXRvbS1hcGlzXG4gICAgICAgICdhdG9tLWlkZS1jb25zb2xlOnNjcm9sbC10by1ib3R0b20nOiAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5fc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICAgYXRvbS5jb21tYW5kcy5hZGQoXG4gICAgICAgIG51bGx0aHJvd3ModGhpcy5fY29uc29sZVNjcm9sbFBhbmVFbCksXG4gICAgICAgICdhdG9tLWlkZTpmaWx0ZXInLFxuICAgICAgICAoKSA9PiB0aGlzLl9mb2N1c0ZpbHRlcigpLFxuICAgICAgKSxcbiAgICApO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XG4gICAgdGhpcy5fZGlzcG9zYWJsZXMuZGlzcG9zZSgpO1xuICAgIHRoaXMuX2V4ZWN1dG9yU2NvcGVEaXNwb3NhYmxlcy5kaXNwb3NlKCk7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBQcm9wcyk6IHZvaWQge1xuICAgIC8vIElmIHJlY29yZHMgYXJlIGFkZGVkIHdoaWxlIHdlJ3JlIHNjcm9sbGVkIHRvIHRoZSBib3R0b20gKG9yIHZlcnkgdmVyeSBjbG9zZSwgYXQgbGVhc3QpLFxuICAgIC8vIGF1dG9tYXRpY2FsbHkgc2Nyb2xsLlxuICAgIGlmIChcbiAgICAgIHRoaXMuX2lzU2Nyb2xsZWROZWFyQm90dG9tICYmXG4gICAgICByZWNvcmRzQ2hhbmdlZChwcmV2UHJvcHMucmVjb3JkcywgdGhpcy5wcm9wcy5yZWNvcmRzKVxuICAgICkge1xuICAgICAgdGhpcy5fc3RhcnRTY3JvbGxUb0JvdHRvbSgpO1xuICAgIH1cbiAgfVxuXG4gIF9mb2N1c0ZpbHRlcigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fY29uc29sZUhlYWRlckNvbXBvbmVudCAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9jb25zb2xlSGVhZGVyQ29tcG9uZW50LmZvY3VzRmlsdGVyKCk7XG4gICAgfVxuICB9XG5cbiAgX3JlbmRlclByb21wdEJ1dHRvbigpOiBSZWFjdC5FbGVtZW50PGFueT4ge1xuICAgIGludmFyaWFudCh0aGlzLnByb3BzLmN1cnJlbnRFeGVjdXRvciAhPSBudWxsKTtcbiAgICBjb25zdCB7Y3VycmVudEV4ZWN1dG9yfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3Qgb3B0aW9ucyA9IEFycmF5LmZyb20odGhpcy5wcm9wcy5leGVjdXRvcnMudmFsdWVzKCkpLm1hcChleGVjdXRvciA9PiAoe1xuICAgICAgaWQ6IGV4ZWN1dG9yLmlkLFxuICAgICAgbGFiZWw6IGV4ZWN1dG9yLm5hbWUsXG4gICAgfSkpO1xuICAgIHJldHVybiAoXG4gICAgICA8UHJvbXB0QnV0dG9uXG4gICAgICAgIHZhbHVlPXtjdXJyZW50RXhlY3V0b3IuaWR9XG4gICAgICAgIG9uQ2hhbmdlPXt0aGlzLnByb3BzLnNlbGVjdEV4ZWN1dG9yfVxuICAgICAgICBvcHRpb25zPXtvcHRpb25zfVxuICAgICAgICBjaGlsZHJlbj17Y3VycmVudEV4ZWN1dG9yLm5hbWV9XG4gICAgICAvPlxuICAgICk7XG4gIH1cblxuICBfaXNTY3JvbGxlZFRvQm90dG9tKFxuICAgIG9mZnNldEhlaWdodDogbnVtYmVyLFxuICAgIHNjcm9sbEhlaWdodDogbnVtYmVyLFxuICAgIHNjcm9sbFRvcDogbnVtYmVyLFxuICApOiBib29sZWFuIHtcbiAgICByZXR1cm4gc2Nyb2xsSGVpZ2h0IC0gKG9mZnNldEhlaWdodCArIHNjcm9sbFRvcCkgPCA1O1xuICB9XG5cbiAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzOiBQcm9wcyk6IHZvaWQge1xuICAgIC8vIElmIHRoZSBtZXNzYWdlcyB3ZXJlIGNsZWFyZWQsIGhpZGUgdGhlIG5vdGlmaWNhdGlvbi5cbiAgICBpZiAobmV4dFByb3BzLnJlY29yZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLl9pc1Njcm9sbGVkTmVhckJvdHRvbSA9IHRydWU7XG4gICAgICB0aGlzLnNldFN0YXRlKHt1bnNlZW5NZXNzYWdlczogZmFsc2V9KTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgLy8gSWYgd2UgcmVjZWl2ZSBuZXcgbWVzc2FnZXMgYWZ0ZXIgd2UndmUgc2Nyb2xsZWQgYXdheSBmcm9tIHRoZSBib3R0b20sIHNob3cgdGhlIFwibmV3XG4gICAgICAvLyBtZXNzYWdlc1wiIG5vdGlmaWNhdGlvbi5cbiAgICAgICF0aGlzLl9pc1Njcm9sbGVkTmVhckJvdHRvbSAmJlxuICAgICAgcmVjb3Jkc0NoYW5nZWQodGhpcy5wcm9wcy5yZWNvcmRzLCBuZXh0UHJvcHMucmVjb3JkcylcbiAgICApIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe3Vuc2Vlbk1lc3NhZ2VzOiB0cnVlfSk7XG4gICAgfVxuXG4gICAgdGhpcy5fZXhlY3V0b3JTY29wZURpc3Bvc2FibGVzLmRpc3Bvc2UoKTtcbiAgICB0aGlzLl9leGVjdXRvclNjb3BlRGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZSgpO1xuICAgIGZvciAoY29uc3QgZXhlY3V0b3Igb2YgbmV4dFByb3BzLmV4ZWN1dG9ycy52YWx1ZXMoKSkge1xuICAgICAgaWYgKGV4ZWN1dG9yICE9IG51bGwgJiYgZXhlY3V0b3Iub25EaWRDaGFuZ2VTY29wZU5hbWUgIT0gbnVsbCkge1xuICAgICAgICB0aGlzLl9leGVjdXRvclNjb3BlRGlzcG9zYWJsZXMuYWRkKFxuICAgICAgICAgIGV4ZWN1dG9yLm9uRGlkQ2hhbmdlU2NvcGVOYW1lKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNjb3BlTmFtZSA9IGV4ZWN1dG9yLnNjb3BlTmFtZSgpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgIHNjb3BlTmFtZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNob3VsZENvbXBvbmVudFVwZGF0ZShuZXh0UHJvcHM6IFByb3BzLCBuZXh0U3RhdGU6IFN0YXRlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgICFzaGFsbG93RXF1YWwodGhpcy5wcm9wcywgbmV4dFByb3BzKSB8fFxuICAgICAgIXNoYWxsb3dFcXVhbCh0aGlzLnN0YXRlLCBuZXh0U3RhdGUpXG4gICAgKTtcbiAgfVxuXG4gIF9nZXRFeGVjdXRvciA9IChpZDogc3RyaW5nKTogP0V4ZWN1dG9yID0+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5leGVjdXRvcnMuZ2V0KGlkKTtcbiAgfTtcblxuICBfZ2V0UHJvdmlkZXIgPSAoaWQ6IHN0cmluZyk6ID9Tb3VyY2VJbmZvID0+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5nZXRQcm92aWRlcihpZCk7XG4gIH07XG5cbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbnNvbGVcIj5cbiAgICAgICAgPFN0eWxlU2hlZXRcbiAgICAgICAgICBzb3VyY2VQYXRoPVwiY29uc29sZS1mb250LXN0eWxlXCJcbiAgICAgICAgICBwcmlvcml0eT17LTF9XG4gICAgICAgICAgY3NzPXtgXG4gICAgICAgICAgICAjY29uc29sZS1mb250LXNpemUtJHt0aGlzLl9pZH0ge1xuICAgICAgICAgICAgICBmb250LXNpemU6ICR7dGhpcy5wcm9wcy5mb250U2l6ZX1weDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBgfVxuICAgICAgICAvPlxuICAgICAgICA8Q29uc29sZUhlYWRlclxuICAgICAgICAgIGNsZWFyPXt0aGlzLnByb3BzLmNsZWFyUmVjb3Jkc31cbiAgICAgICAgICBjcmVhdGVQYXN0ZT17dGhpcy5wcm9wcy5jcmVhdGVQYXN0ZX1cbiAgICAgICAgICBpbnZhbGlkRmlsdGVySW5wdXQ9e3RoaXMucHJvcHMuaW52YWxpZEZpbHRlcklucHV0fVxuICAgICAgICAgIGVuYWJsZVJlZ0V4cEZpbHRlcj17dGhpcy5wcm9wcy5lbmFibGVSZWdFeHBGaWx0ZXJ9XG4gICAgICAgICAgZmlsdGVyVGV4dD17dGhpcy5wcm9wcy5maWx0ZXJUZXh0fVxuICAgICAgICAgIHJlZj17Y29tcG9uZW50ID0+ICh0aGlzLl9jb25zb2xlSGVhZGVyQ29tcG9uZW50ID0gY29tcG9uZW50KX1cbiAgICAgICAgICBzZWxlY3RlZFNvdXJjZUlkcz17dGhpcy5wcm9wcy5zZWxlY3RlZFNvdXJjZUlkc31cbiAgICAgICAgICBzb3VyY2VzPXt0aGlzLnByb3BzLnNvdXJjZXN9XG4gICAgICAgICAgb25GaWx0ZXJDaGFuZ2U9e3RoaXMucHJvcHMudXBkYXRlRmlsdGVyfVxuICAgICAgICAgIG9uU2VsZWN0ZWRTb3VyY2VzQ2hhbmdlPXt0aGlzLnByb3BzLnNlbGVjdFNvdXJjZXN9XG4gICAgICAgICAgc2VsZWN0ZWRTZXZlcml0aWVzPXt0aGlzLnByb3BzLnNlbGVjdGVkU2V2ZXJpdGllc31cbiAgICAgICAgICB0b2dnbGVTZXZlcml0eT17dGhpcy5wcm9wcy50b2dnbGVTZXZlcml0eX1cbiAgICAgICAgLz5cbiAgICAgICAgey8qXG4gICAgICAgICAgV2UgbmVlZCBhbiBleHRyYSB3cmFwcGVyIGVsZW1lbnQgaGVyZSBpbiBvcmRlciB0byBoYXZlIHRoZSBuZXcgbWVzc2FnZXMgbm90aWZpY2F0aW9uIHN0aWNrXG4gICAgICAgICAgdG8gdGhlIGJvdHRvbSBvZiB0aGUgc2Nyb2xsYWJsZSBhcmVhIChhbmQgbm90IHNjcm9sbCB3aXRoIGl0KS5cblxuICAgICAgICAgIGNvbnNvbGUtZm9udC1zaXplIGlzIGRlZmluZWQgaW4gbWFpbi5qcyBhbmQgdXBkYXRlZCB2aWEgYSB1c2VyIHNldHRpbmdcbiAgICAgICAgKi99XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY29uc29sZS1ib2R5XCIgaWQ9eydjb25zb2xlLWZvbnQtc2l6ZS0nICsgdGhpcy5faWR9PlxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImNvbnNvbGUtc2Nyb2xsLXBhbmUtd3JhcHBlciBhdG9tLWlkZS1maWx0ZXJhYmxlXCJcbiAgICAgICAgICAgIHJlZj17ZWwgPT4gKHRoaXMuX2NvbnNvbGVTY3JvbGxQYW5lRWwgPSBlbCl9PlxuICAgICAgICAgICAgPEZpbHRlclJlbWluZGVyXG4gICAgICAgICAgICAgIG5vdW49XCJtZXNzYWdlXCJcbiAgICAgICAgICAgICAgbm91blBsdXJhbD1cIm1lc3NhZ2VzXCJcbiAgICAgICAgICAgICAgZmlsdGVyZWRSZWNvcmRDb3VudD17dGhpcy5wcm9wcy5maWx0ZXJlZFJlY29yZENvdW50fVxuICAgICAgICAgICAgICBvblJlc2V0PXt0aGlzLnByb3BzLnJlc2V0QWxsRmlsdGVyc31cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8T3V0cHV0VGFibGVcbiAgICAgICAgICAgICAgLy8gJEZsb3dGaXhNZSg+PTAuNTMuMCkgRmxvdyBzdXBwcmVzc1xuICAgICAgICAgICAgICByZWY9e3RoaXMuX2hhbmRsZU91dHB1dFRhYmxlfVxuICAgICAgICAgICAgICByZWNvcmRzPXt0aGlzLnByb3BzLnJlY29yZHN9XG4gICAgICAgICAgICAgIHNob3dTb3VyY2VMYWJlbHM9e3RoaXMucHJvcHMuc2VsZWN0ZWRTb3VyY2VJZHMubGVuZ3RoID4gMX1cbiAgICAgICAgICAgICAgZm9udFNpemU9e3RoaXMucHJvcHMuZm9udFNpemV9XG4gICAgICAgICAgICAgIGdldEV4ZWN1dG9yPXt0aGlzLl9nZXRFeGVjdXRvcn1cbiAgICAgICAgICAgICAgZ2V0UHJvdmlkZXI9e3RoaXMuX2dldFByb3ZpZGVyfVxuICAgICAgICAgICAgICBvblNjcm9sbD17dGhpcy5faGFuZGxlU2Nyb2xsfVxuICAgICAgICAgICAgICBzaG91bGRTY3JvbGxUb0JvdHRvbT17dGhpcy5fc2hvdWxkU2Nyb2xsVG9Cb3R0b219XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgPE5ld01lc3NhZ2VzTm90aWZpY2F0aW9uXG4gICAgICAgICAgICAgIHZpc2libGU9e3RoaXMuc3RhdGUudW5zZWVuTWVzc2FnZXN9XG4gICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuX3N0YXJ0U2Nyb2xsVG9Cb3R0b219XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIHt0aGlzLl9yZW5kZXJQcm9tcHQoKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgX2dldE11bHRpTGluZVRpcCgpOiBzdHJpbmcge1xuICAgIGNvbnN0IHtjdXJyZW50RXhlY3V0b3J9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoY3VycmVudEV4ZWN1dG9yID09IG51bGwpIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgY29uc3Qga2V5Q29tYm8gPVxuICAgICAgcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ2RhcndpbidcbiAgICAgICAgPyAvLyBPcHRpb24gKyBFbnRlciBvbiBNYWNcbiAgICAgICAgICAnXFx1MjMyNSAgKyBcXHUyM0NFJ1xuICAgICAgICA6IC8vIFNoaWZ0ICsgRW50ZXIgb24gV2luZG93cyBhbmQgTGludXguXG4gICAgICAgICAgJ1NoaWZ0ICsgRW50ZXInO1xuXG4gICAgcmV0dXJuIGBUaXA6ICR7a2V5Q29tYm99IHRvIGluc2VydCBhIG5ld2xpbmVgO1xuICB9XG5cbiAgX3JlbmRlclByb21wdCgpOiA/UmVhY3QuRWxlbWVudDxhbnk+IHtcbiAgICBjb25zdCB7Y3VycmVudEV4ZWN1dG9yfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGN1cnJlbnRFeGVjdXRvciA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbnNvbGUtcHJvbXB0XCI+XG4gICAgICAgIHt0aGlzLl9yZW5kZXJQcm9tcHRCdXR0b24oKX1cbiAgICAgICAgPElucHV0QXJlYVxuICAgICAgICAgIHJlZj17KGNvbXBvbmVudDogP0lucHV0QXJlYSkgPT4gKHRoaXMuX2lucHV0QXJlYSA9IGNvbXBvbmVudCl9XG4gICAgICAgICAgc2NvcGVOYW1lPXt0aGlzLnN0YXRlLnNjb3BlTmFtZX1cbiAgICAgICAgICBmb250U2l6ZT17dGhpcy5wcm9wcy5mb250U2l6ZX1cbiAgICAgICAgICBvblN1Ym1pdD17dGhpcy5fZXhlY3V0ZVByb21wdH1cbiAgICAgICAgICBoaXN0b3J5PXt0aGlzLnByb3BzLmhpc3Rvcnl9XG4gICAgICAgICAgd2F0Y2hFZGl0b3I9e3RoaXMucHJvcHMud2F0Y2hFZGl0b3J9XG4gICAgICAgICAgcGxhY2Vob2xkZXJUZXh0PXt0aGlzLl9nZXRNdWx0aUxpbmVUaXAoKX1cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICBfZXhlY3V0ZVByb21wdCA9IChjb2RlOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICB0aGlzLnByb3BzLmV4ZWN1dGUoY29kZSk7XG4gICAgLy8gTWFrZXMgdGhlIGNvbnNvbGUgdG8gc2Nyb2xsIHRvIHRoZSBib3R0b20uXG4gICAgdGhpcy5faXNTY3JvbGxlZE5lYXJCb3R0b20gPSB0cnVlO1xuICB9O1xuXG4gIF9oYW5kbGVTY3JvbGwgPSAoXG4gICAgb2Zmc2V0SGVpZ2h0OiBudW1iZXIsXG4gICAgc2Nyb2xsSGVpZ2h0OiBudW1iZXIsXG4gICAgc2Nyb2xsVG9wOiBudW1iZXIsXG4gICk6IHZvaWQgPT4ge1xuICAgIHRoaXMuX2hhbmRsZVNjcm9sbEVuZChvZmZzZXRIZWlnaHQsIHNjcm9sbEhlaWdodCwgc2Nyb2xsVG9wKTtcbiAgfTtcblxuICBfaGFuZGxlU2Nyb2xsRW5kKFxuICAgIG9mZnNldEhlaWdodDogbnVtYmVyLFxuICAgIHNjcm9sbEhlaWdodDogbnVtYmVyLFxuICAgIHNjcm9sbFRvcDogbnVtYmVyLFxuICApOiB2b2lkIHtcbiAgICBjb25zdCBpc1Njcm9sbGVkVG9Cb3R0b20gPSB0aGlzLl9pc1Njcm9sbGVkVG9Cb3R0b20oXG4gICAgICBvZmZzZXRIZWlnaHQsXG4gICAgICBzY3JvbGxIZWlnaHQsXG4gICAgICBzY3JvbGxUb3AsXG4gICAgKTtcblxuICAgIHRoaXMuX2lzU2Nyb2xsZWROZWFyQm90dG9tID0gaXNTY3JvbGxlZFRvQm90dG9tO1xuICAgIHRoaXMuX3N0b3BTY3JvbGxUb0JvdHRvbSgpO1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgLy8gVE9ETzogKHdiaW5uc3NtaXRoKSBUMzA3NzE0MzUgdGhpcyBzZXRTdGF0ZSBkZXBlbmRzIG9uIGN1cnJlbnQgc3RhdGVcbiAgICAgIC8vIGFuZCBzaG91bGQgdXNlIGFuIHVwZGF0ZXIgZnVuY3Rpb24gcmF0aGVyIHRoYW4gYW4gb2JqZWN0XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvbm8tYWNjZXNzLXN0YXRlLWluLXNldHN0YXRlXG4gICAgICB1bnNlZW5NZXNzYWdlczogdGhpcy5zdGF0ZS51bnNlZW5NZXNzYWdlcyAmJiAhdGhpcy5faXNTY3JvbGxlZE5lYXJCb3R0b20sXG4gICAgfSk7XG4gIH1cblxuICBfaGFuZGxlT3V0cHV0VGFibGUgPSAocmVmOiBPdXRwdXRUYWJsZSk6IHZvaWQgPT4ge1xuICAgIHRoaXMuX291dHB1dFRhYmxlID0gcmVmO1xuICB9O1xuXG4gIF9zY3JvbGxUb0JvdHRvbSA9ICgpOiB2b2lkID0+IHtcbiAgICBpZiAoIXRoaXMuX291dHB1dFRhYmxlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5fb3V0cHV0VGFibGUuc2Nyb2xsVG9Cb3R0b20oKTtcblxuICAgIHRoaXMuc2V0U3RhdGUoe3Vuc2Vlbk1lc3NhZ2VzOiBmYWxzZX0pO1xuICB9O1xuXG4gIF9zdGFydFNjcm9sbFRvQm90dG9tID0gKCk6IHZvaWQgPT4ge1xuICAgIGlmICghdGhpcy5fY29udGludW91c2x5U2Nyb2xsVG9Cb3R0b20pIHtcbiAgICAgIHRoaXMuX2NvbnRpbnVvdXNseVNjcm9sbFRvQm90dG9tID0gdHJ1ZTtcblxuICAgICAgdGhpcy5fc2Nyb2xsaW5nVGhyb3R0bGUgPSBPYnNlcnZhYmxlLnRpbWVyKFxuICAgICAgICBNQVhJTVVNX1NDUk9MTElOR19USU1FLFxuICAgICAgKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLl9zdG9wU2Nyb2xsVG9Cb3R0b20oKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuX3Njcm9sbFRvQm90dG9tKCk7XG4gIH07XG5cbiAgX3N0b3BTY3JvbGxUb0JvdHRvbSA9ICgpOiB2b2lkID0+IHtcbiAgICB0aGlzLl9jb250aW51b3VzbHlTY3JvbGxUb0JvdHRvbSA9IGZhbHNlO1xuICAgIGlmICh0aGlzLl9zY3JvbGxpbmdUaHJvdHRsZSAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9zY3JvbGxpbmdUaHJvdHRsZS51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfTtcblxuICBfc2hvdWxkU2Nyb2xsVG9Cb3R0b20gPSAoKTogYm9vbGVhbiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX2lzU2Nyb2xsZWROZWFyQm90dG9tIHx8IHRoaXMuX2NvbnRpbnVvdXNseVNjcm9sbFRvQm90dG9tO1xuICB9O1xufVxuIl19