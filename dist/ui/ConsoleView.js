"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _observable = require("@atom-ide-community/nuclide-commons/observable");

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var React = _interopRequireWildcard(require("react"));

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

var _FilterReminder = _interopRequireDefault(require("@atom-ide-community/nuclide-commons-ui/FilterReminder"));

var _OutputTable = _interopRequireDefault(require("./OutputTable"));

var _ConsoleHeader = _interopRequireDefault(require("./ConsoleHeader"));

var _InputArea = _interopRequireDefault(require("./InputArea"));

var _PromptButton = _interopRequireDefault(require("./PromptButton"));

var _NewMessagesNotification = _interopRequireDefault(require("./NewMessagesNotification"));

var _assert = _interopRequireDefault(require("assert"));

var _nullthrows = _interopRequireDefault(require("nullthrows"));

var _shallowequal = _interopRequireDefault(require("shallowequal"));

var _recordsChanged = _interopRequireDefault(require("../recordsChanged"));

var _StyleSheet = _interopRequireDefault(require("@atom-ide-community/nuclide-commons-ui/StyleSheet"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Maximum time (ms) for the console to try scrolling to the bottom.
const MAXIMUM_SCROLLING_TIME = 3000;
const DEFAULT_SCOPE_NAME = "text.plain";
let count = 0;

class ConsoleView extends React.Component {
  // Used when _scrollToBottom is called. The console optimizes message loading
  // so scrolling to the bottom once doesn't always scroll to the bottom since
  // more messages can be loaded after.
  constructor(props) {
    super(props);
    this._consoleScrollPaneEl = void 0;
    this._consoleHeaderComponent = void 0;
    this._disposables = void 0;
    this._executorScopeDisposables = void 0;
    this._isScrolledNearBottom = void 0;
    this._id = void 0;
    this._inputArea = void 0;
    this._continuouslyScrollToBottom = void 0;
    this._scrollingThrottle = void 0;
    this._outputTable = void 0;

    this._getExecutor = id => {
      return this.props.executors.get(id);
    };

    this._getProvider = id => {
      return this.props.getProvider(id);
    };

    this._executePrompt = code => {
      this.props.execute(code); // Makes the console to scroll to the bottom.

      this._isScrolledNearBottom = true;
    };

    this._handleScroll = (offsetHeight, scrollHeight, scrollTop) => {
      this._handleScrollEnd(offsetHeight, scrollHeight, scrollTop);
    };

    this._handleOutputTable = ref => {
      this._outputTable = ref;
    };

    this._scrollToBottom = () => {
      if (!this._outputTable) {
        return;
      }

      this._outputTable.scrollToBottom();

      this.setState({
        unseenMessages: false
      });
    };

    this._startScrollToBottom = () => {
      if (!this._continuouslyScrollToBottom) {
        this._continuouslyScrollToBottom = true;
        this._scrollingThrottle = _rxjsCompatUmdMin.Observable.timer(MAXIMUM_SCROLLING_TIME).subscribe(() => {
          this._stopScrollToBottom();
        });
      }

      this._scrollToBottom();
    };

    this._stopScrollToBottom = () => {
      this._continuouslyScrollToBottom = false;

      if (this._scrollingThrottle != null) {
        this._scrollingThrottle.unsubscribe();
      }
    };

    this._shouldScrollToBottom = () => {
      return this._isScrolledNearBottom || this._continuouslyScrollToBottom;
    };

    this.state = {
      unseenMessages: false,
      scopeName: DEFAULT_SCOPE_NAME
    };
    this._disposables = new _UniversalDisposable.default();
    this._executorScopeDisposables = new _UniversalDisposable.default();
    this._isScrolledNearBottom = true;
    this._continuouslyScrollToBottom = false;
    this._id = count++;
  }

  componentDidMount() {
    this._disposables.add( // Wait for `<OutputTable />` to render itself via react-virtualized before scrolling and
    // re-measuring; Otherwise, the scrolled location will be inaccurate, preventing the Console
    // from auto-scrolling.
    _observable.macrotask.subscribe(() => {
      this._startScrollToBottom();
    }), () => {
      if (this._scrollingThrottle != null) {
        this._scrollingThrottle.unsubscribe();
      }
    }, atom.commands.add("atom-workspace", {
      // eslint-disable-next-line nuclide-internal/atom-apis
      "atom-ide-console:focus-console-prompt": () => {
        if (this._inputArea != null) {
          this._inputArea.focus();
        }
      }
    }), atom.commands.add("atom-workspace", {
      // eslint-disable-next-line nuclide-internal/atom-apis
      "atom-ide-console:scroll-to-bottom": () => {
        this._scrollToBottom();
      }
    }), atom.commands.add((0, _nullthrows.default)(this._consoleScrollPaneEl), "atom-ide:filter", () => this._focusFilter()));
  }

  componentWillUnmount() {
    this._disposables.dispose();

    this._executorScopeDisposables.dispose();
  }

  componentDidUpdate(prevProps) {
    // If records are added while we're scrolled to the bottom (or very very close, at least),
    // automatically scroll.
    if (this._isScrolledNearBottom && (0, _recordsChanged.default)(prevProps.records, this.props.records)) {
      this._startScrollToBottom();
    }
  }

  _focusFilter() {
    if (this._consoleHeaderComponent != null) {
      this._consoleHeaderComponent.focusFilter();
    }
  }

  _renderPromptButton() {
    (0, _assert.default)(this.props.currentExecutor != null);
    const {
      currentExecutor
    } = this.props;
    const options = Array.from(this.props.executors.values()).map(executor => ({
      id: executor.id,
      label: executor.name
    }));
    return /*#__PURE__*/React.createElement(_PromptButton.default, {
      value: currentExecutor.id,
      onChange: this.props.selectExecutor,
      options: options,
      children: currentExecutor.name
    });
  }

  _isScrolledToBottom(offsetHeight, scrollHeight, scrollTop) {
    return scrollHeight - (offsetHeight + scrollTop) < 5;
  }

  UNSAFE_componentWillReceiveProps(nextProps) {
    // If the messages were cleared, hide the notification.
    if (nextProps.records.length === 0) {
      this._isScrolledNearBottom = true;
      this.setState({
        unseenMessages: false
      });
    } else if ( // If we receive new messages after we've scrolled away from the bottom, show the "new
    // messages" notification.
    !this._isScrolledNearBottom && (0, _recordsChanged.default)(this.props.records, nextProps.records)) {
      this.setState({
        unseenMessages: true
      });
    }

    this._executorScopeDisposables.dispose();

    this._executorScopeDisposables = new _UniversalDisposable.default();

    for (const executor of nextProps.executors.values()) {
      if (executor != null && executor.onDidChangeScopeName != null) {
        this._executorScopeDisposables.add(executor.onDidChangeScopeName(() => {
          const scopeName = executor.scopeName();
          this.setState({
            scopeName
          });
        }));
      }
    }
  }

  shouldComponentUpdate(nextProps, nextState) {
    return !(0, _shallowequal.default)(this.props, nextProps) || !(0, _shallowequal.default)(this.state, nextState);
  }

  render() {
    return /*#__PURE__*/React.createElement("div", {
      className: "console"
    }, /*#__PURE__*/React.createElement(_StyleSheet.default, {
      sourcePath: "console-font-style",
      priority: -1,
      css: `
            #console-font-size-${this._id} {
              font-size: ${this.props.fontSize}px;
            }
          `
    }), /*#__PURE__*/React.createElement(_ConsoleHeader.default, {
      clear: this.props.clearRecords,
      createPaste: this.props.createPaste,
      invalidFilterInput: this.props.invalidFilterInput,
      enableRegExpFilter: this.props.enableRegExpFilter,
      filterText: this.props.filterText,
      ref: component => this._consoleHeaderComponent = component,
      selectedSourceIds: this.props.selectedSourceIds,
      sources: this.props.sources,
      onFilterChange: this.props.updateFilter,
      onSelectedSourcesChange: this.props.selectSources,
      selectedSeverities: this.props.selectedSeverities,
      toggleSeverity: this.props.toggleSeverity
    }), /*#__PURE__*/React.createElement("div", {
      className: "console-body",
      id: "console-font-size-" + this._id
    }, /*#__PURE__*/React.createElement("div", {
      className: "console-scroll-pane-wrapper atom-ide-filterable",
      ref: el => this._consoleScrollPaneEl = el
    }, /*#__PURE__*/React.createElement(_FilterReminder.default, {
      noun: "message",
      nounPlural: "messages",
      filteredRecordCount: this.props.filteredRecordCount,
      onReset: this.props.resetAllFilters
    }), /*#__PURE__*/React.createElement(_OutputTable.default // $FlowFixMe(>=0.53.0) Flow suppress
    , {
      ref: this._handleOutputTable,
      records: this.props.records,
      showSourceLabels: this.props.selectedSourceIds.length > 1,
      fontSize: this.props.fontSize,
      getExecutor: this._getExecutor,
      getProvider: this._getProvider,
      onScroll: this._handleScroll,
      shouldScrollToBottom: this._shouldScrollToBottom
    }), /*#__PURE__*/React.createElement(_NewMessagesNotification.default, {
      visible: this.state.unseenMessages,
      onClick: this._startScrollToBottom
    })), this._renderPrompt()));
  }

  _getMultiLineTip() {
    const {
      currentExecutor
    } = this.props;

    if (currentExecutor == null) {
      return "";
    }

    const keyCombo = process.platform === "darwin" ? // Option + Enter on Mac
    "\u2325  + \u23CE" : // Shift + Enter on Windows and Linux.
    "Shift + Enter";
    return `Tip: ${keyCombo} to insert a newline`;
  }

  _renderPrompt() {
    const {
      currentExecutor
    } = this.props;

    if (currentExecutor == null) {
      return;
    }

    return /*#__PURE__*/React.createElement("div", {
      className: "console-prompt"
    }, this._renderPromptButton(), /*#__PURE__*/React.createElement(_InputArea.default, {
      ref: component => this._inputArea = component,
      scopeName: this.state.scopeName,
      fontSize: this.props.fontSize,
      onSubmit: this._executePrompt,
      history: this.props.history,
      watchEditor: this.props.watchEditor,
      placeholderText: this._getMultiLineTip()
    }));
  }

  _handleScrollEnd(offsetHeight, scrollHeight, scrollTop) {
    const isScrolledToBottom = this._isScrolledToBottom(offsetHeight, scrollHeight, scrollTop);

    this._isScrolledNearBottom = isScrolledToBottom;

    this._stopScrollToBottom();

    this.setState({
      // TODO: (wbinnssmith) T30771435 this setState depends on current state
      // and should use an updater function rather than an object
      // eslint-disable-next-line react/no-access-state-in-setstate
      unseenMessages: this.state.unseenMessages && !this._isScrolledNearBottom
    });
  }

}

exports.default = ConsoleView;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbnNvbGVWaWV3LmpzIl0sIm5hbWVzIjpbIk1BWElNVU1fU0NST0xMSU5HX1RJTUUiLCJERUZBVUxUX1NDT1BFX05BTUUiLCJjb3VudCIsIkNvbnNvbGVWaWV3IiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiX2NvbnNvbGVTY3JvbGxQYW5lRWwiLCJfY29uc29sZUhlYWRlckNvbXBvbmVudCIsIl9kaXNwb3NhYmxlcyIsIl9leGVjdXRvclNjb3BlRGlzcG9zYWJsZXMiLCJfaXNTY3JvbGxlZE5lYXJCb3R0b20iLCJfaWQiLCJfaW5wdXRBcmVhIiwiX2NvbnRpbnVvdXNseVNjcm9sbFRvQm90dG9tIiwiX3Njcm9sbGluZ1Rocm90dGxlIiwiX291dHB1dFRhYmxlIiwiX2dldEV4ZWN1dG9yIiwiaWQiLCJleGVjdXRvcnMiLCJnZXQiLCJfZ2V0UHJvdmlkZXIiLCJnZXRQcm92aWRlciIsIl9leGVjdXRlUHJvbXB0IiwiY29kZSIsImV4ZWN1dGUiLCJfaGFuZGxlU2Nyb2xsIiwib2Zmc2V0SGVpZ2h0Iiwic2Nyb2xsSGVpZ2h0Iiwic2Nyb2xsVG9wIiwiX2hhbmRsZVNjcm9sbEVuZCIsIl9oYW5kbGVPdXRwdXRUYWJsZSIsInJlZiIsIl9zY3JvbGxUb0JvdHRvbSIsInNjcm9sbFRvQm90dG9tIiwic2V0U3RhdGUiLCJ1bnNlZW5NZXNzYWdlcyIsIl9zdGFydFNjcm9sbFRvQm90dG9tIiwiT2JzZXJ2YWJsZSIsInRpbWVyIiwic3Vic2NyaWJlIiwiX3N0b3BTY3JvbGxUb0JvdHRvbSIsInVuc3Vic2NyaWJlIiwiX3Nob3VsZFNjcm9sbFRvQm90dG9tIiwic3RhdGUiLCJzY29wZU5hbWUiLCJVbml2ZXJzYWxEaXNwb3NhYmxlIiwiY29tcG9uZW50RGlkTW91bnQiLCJhZGQiLCJtYWNyb3Rhc2siLCJhdG9tIiwiY29tbWFuZHMiLCJmb2N1cyIsIl9mb2N1c0ZpbHRlciIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGlzcG9zZSIsImNvbXBvbmVudERpZFVwZGF0ZSIsInByZXZQcm9wcyIsInJlY29yZHMiLCJmb2N1c0ZpbHRlciIsIl9yZW5kZXJQcm9tcHRCdXR0b24iLCJjdXJyZW50RXhlY3V0b3IiLCJvcHRpb25zIiwiQXJyYXkiLCJmcm9tIiwidmFsdWVzIiwibWFwIiwiZXhlY3V0b3IiLCJsYWJlbCIsIm5hbWUiLCJzZWxlY3RFeGVjdXRvciIsIl9pc1Njcm9sbGVkVG9Cb3R0b20iLCJVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsIm5leHRQcm9wcyIsImxlbmd0aCIsIm9uRGlkQ2hhbmdlU2NvcGVOYW1lIiwic2hvdWxkQ29tcG9uZW50VXBkYXRlIiwibmV4dFN0YXRlIiwicmVuZGVyIiwiZm9udFNpemUiLCJjbGVhclJlY29yZHMiLCJjcmVhdGVQYXN0ZSIsImludmFsaWRGaWx0ZXJJbnB1dCIsImVuYWJsZVJlZ0V4cEZpbHRlciIsImZpbHRlclRleHQiLCJjb21wb25lbnQiLCJzZWxlY3RlZFNvdXJjZUlkcyIsInNvdXJjZXMiLCJ1cGRhdGVGaWx0ZXIiLCJzZWxlY3RTb3VyY2VzIiwic2VsZWN0ZWRTZXZlcml0aWVzIiwidG9nZ2xlU2V2ZXJpdHkiLCJlbCIsImZpbHRlcmVkUmVjb3JkQ291bnQiLCJyZXNldEFsbEZpbHRlcnMiLCJfcmVuZGVyUHJvbXB0IiwiX2dldE11bHRpTGluZVRpcCIsImtleUNvbWJvIiwicHJvY2VzcyIsInBsYXRmb3JtIiwiaGlzdG9yeSIsIndhdGNoRWRpdG9yIiwiaXNTY3JvbGxlZFRvQm90dG9tIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBZ0NBO0FBQ0EsTUFBTUEsc0JBQXNCLEdBQUcsSUFBL0I7QUFDQSxNQUFNQyxrQkFBa0IsR0FBRyxZQUEzQjtBQUVBLElBQUlDLEtBQUssR0FBRyxDQUFaOztBQUVl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aXR5LCBSZWNvcmQsIFNvdXJjZSwgU291cmNlSW5mbyB9IGZyb20gXCIuLi90eXBlc1wiXG5pbXBvcnQgdHlwZSB7IFJlZ0V4cEZpbHRlckNoYW5nZSB9IGZyb20gXCJAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aS9SZWdFeHBGaWx0ZXJcIlxuXG5pbXBvcnQgeyBtYWNyb3Rhc2sgfSBmcm9tIFwiQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvb2JzZXJ2YWJsZVwiXG5pbXBvcnQgVW5pdmVyc2FsRGlzcG9zYWJsZSBmcm9tIFwiQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvVW5pdmVyc2FsRGlzcG9zYWJsZVwiXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzLWNvbXBhdC9idW5kbGVzL3J4anMtY29tcGF0LnVtZC5taW4uanNcIlxuaW1wb3J0IEZpbHRlclJlbWluZGVyIGZyb20gXCJAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aS9GaWx0ZXJSZW1pbmRlclwiXG5pbXBvcnQgT3V0cHV0VGFibGUgZnJvbSBcIi4vT3V0cHV0VGFibGVcIlxuaW1wb3J0IENvbnNvbGVIZWFkZXIgZnJvbSBcIi4vQ29uc29sZUhlYWRlclwiXG5pbXBvcnQgSW5wdXRBcmVhIGZyb20gXCIuL0lucHV0QXJlYVwiXG5pbXBvcnQgUHJvbXB0QnV0dG9uIGZyb20gXCIuL1Byb21wdEJ1dHRvblwiXG5pbXBvcnQgTmV3TWVzc2FnZXNOb3RpZmljYXRpb24gZnJvbSBcIi4vTmV3TWVzc2FnZXNOb3RpZmljYXRpb25cIlxuaW1wb3J0IGludmFyaWFudCBmcm9tIFwiYXNzZXJ0XCJcbmltcG9ydCBudWxsdGhyb3dzIGZyb20gXCJudWxsdGhyb3dzXCJcbmltcG9ydCBzaGFsbG93RXF1YWwgZnJvbSBcInNoYWxsb3dlcXVhbFwiXG5pbXBvcnQgcmVjb3Jkc0NoYW5nZWQgZnJvbSBcIi4uL3JlY29yZHNDaGFuZ2VkXCJcbmltcG9ydCBTdHlsZVNoZWV0IGZyb20gXCJAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aS9TdHlsZVNoZWV0XCJcblxudHlwZSBQcm9wcyA9IHtcbiAgcmVjb3JkczogQXJyYXk8UmVjb3JkPixcbiAgaGlzdG9yeTogQXJyYXk8c3RyaW5nPixcbiAgY2xlYXJSZWNvcmRzOiAoKSA9PiB2b2lkLFxuICBjcmVhdGVQYXN0ZTogPygpID0+IFByb21pc2U8dm9pZD4sXG4gIHdhdGNoRWRpdG9yOiA/YXRvbSRBdXRvY29tcGxldGVXYXRjaEVkaXRvcixcbiAgZXhlY3V0ZTogKGNvZGU6IHN0cmluZykgPT4gdm9pZCxcbiAgY3VycmVudEV4ZWN1dG9yOiA/RXhlY3V0b3IsXG4gIGV4ZWN1dG9yczogTWFwPHN0cmluZywgRXhlY3V0b3I+LFxuICBpbnZhbGlkRmlsdGVySW5wdXQ6IGJvb2xlYW4sXG4gIGVuYWJsZVJlZ0V4cEZpbHRlcjogYm9vbGVhbixcbiAgc2VsZWN0ZWRTb3VyY2VJZHM6IEFycmF5PHN0cmluZz4sXG4gIHNlbGVjdEV4ZWN1dG9yOiAoZXhlY3V0b3JJZDogc3RyaW5nKSA9PiB2b2lkLFxuICBzZWxlY3RTb3VyY2VzOiAoc291cmNlSWRzOiBBcnJheTxzdHJpbmc+KSA9PiB2b2lkLFxuICBzb3VyY2VzOiBBcnJheTxTb3VyY2U+LFxuICB1cGRhdGVGaWx0ZXI6IChjaGFuZ2U6IFJlZ0V4cEZpbHRlckNoYW5nZSkgPT4gdm9pZCxcbiAgZ2V0UHJvdmlkZXI6IChpZDogc3RyaW5nKSA9PiA/U291cmNlSW5mbyxcbiAgZmlsdGVyZWRSZWNvcmRDb3VudDogbnVtYmVyLFxuICBmaWx0ZXJUZXh0OiBzdHJpbmcsXG4gIHJlc2V0QWxsRmlsdGVyczogKCkgPT4gdm9pZCxcbiAgZm9udFNpemU6IG51bWJlcixcbiAgc2VsZWN0ZWRTZXZlcml0aWVzOiBTZXQ8U2V2ZXJpdHk+LFxuICB0b2dnbGVTZXZlcml0eTogKHNldmVyaXR5OiBTZXZlcml0eSkgPT4gdm9pZCxcbn1cblxudHlwZSBTdGF0ZSA9IHtcbiAgdW5zZWVuTWVzc2FnZXM6IGJvb2xlYW4sXG4gIHNjb3BlTmFtZTogc3RyaW5nLFxufVxuXG4vLyBNYXhpbXVtIHRpbWUgKG1zKSBmb3IgdGhlIGNvbnNvbGUgdG8gdHJ5IHNjcm9sbGluZyB0byB0aGUgYm90dG9tLlxuY29uc3QgTUFYSU1VTV9TQ1JPTExJTkdfVElNRSA9IDMwMDBcbmNvbnN0IERFRkFVTFRfU0NPUEVfTkFNRSA9IFwidGV4dC5wbGFpblwiXG5cbmxldCBjb3VudCA9IDBcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uc29sZVZpZXcgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UHJvcHMsIFN0YXRlPiB7XG4gIF9jb25zb2xlU2Nyb2xsUGFuZUVsOiA/SFRNTERpdkVsZW1lbnRcbiAgX2NvbnNvbGVIZWFkZXJDb21wb25lbnQ6ID9Db25zb2xlSGVhZGVyXG4gIF9kaXNwb3NhYmxlczogVW5pdmVyc2FsRGlzcG9zYWJsZVxuICBfZXhlY3V0b3JTY29wZURpc3Bvc2FibGVzOiBVbml2ZXJzYWxEaXNwb3NhYmxlXG4gIF9pc1Njcm9sbGVkTmVhckJvdHRvbTogYm9vbGVhblxuICBfaWQ6IG51bWJlclxuICBfaW5wdXRBcmVhOiA/SW5wdXRBcmVhXG5cbiAgLy8gVXNlZCB3aGVuIF9zY3JvbGxUb0JvdHRvbSBpcyBjYWxsZWQuIFRoZSBjb25zb2xlIG9wdGltaXplcyBtZXNzYWdlIGxvYWRpbmdcbiAgLy8gc28gc2Nyb2xsaW5nIHRvIHRoZSBib3R0b20gb25jZSBkb2Vzbid0IGFsd2F5cyBzY3JvbGwgdG8gdGhlIGJvdHRvbSBzaW5jZVxuICAvLyBtb3JlIG1lc3NhZ2VzIGNhbiBiZSBsb2FkZWQgYWZ0ZXIuXG4gIF9jb250aW51b3VzbHlTY3JvbGxUb0JvdHRvbTogYm9vbGVhblxuICBfc2Nyb2xsaW5nVGhyb3R0bGU6ID9yeGpzJFN1YnNjcmlwdGlvblxuXG4gIF9vdXRwdXRUYWJsZTogP091dHB1dFRhYmxlXG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHVuc2Vlbk1lc3NhZ2VzOiBmYWxzZSxcbiAgICAgIHNjb3BlTmFtZTogREVGQVVMVF9TQ09QRV9OQU1FLFxuICAgIH1cbiAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKClcbiAgICB0aGlzLl9leGVjdXRvclNjb3BlRGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZSgpXG4gICAgdGhpcy5faXNTY3JvbGxlZE5lYXJCb3R0b20gPSB0cnVlXG4gICAgdGhpcy5fY29udGludW91c2x5U2Nyb2xsVG9Cb3R0b20gPSBmYWxzZVxuICAgIHRoaXMuX2lkID0gY291bnQrK1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKTogdm9pZCB7XG4gICAgdGhpcy5fZGlzcG9zYWJsZXMuYWRkKFxuICAgICAgLy8gV2FpdCBmb3IgYDxPdXRwdXRUYWJsZSAvPmAgdG8gcmVuZGVyIGl0c2VsZiB2aWEgcmVhY3QtdmlydHVhbGl6ZWQgYmVmb3JlIHNjcm9sbGluZyBhbmRcbiAgICAgIC8vIHJlLW1lYXN1cmluZzsgT3RoZXJ3aXNlLCB0aGUgc2Nyb2xsZWQgbG9jYXRpb24gd2lsbCBiZSBpbmFjY3VyYXRlLCBwcmV2ZW50aW5nIHRoZSBDb25zb2xlXG4gICAgICAvLyBmcm9tIGF1dG8tc2Nyb2xsaW5nLlxuICAgICAgbWFjcm90YXNrLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMuX3N0YXJ0U2Nyb2xsVG9Cb3R0b20oKVxuICAgICAgfSksXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLl9zY3JvbGxpbmdUaHJvdHRsZSAhPSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5fc2Nyb2xsaW5nVGhyb3R0bGUudW5zdWJzY3JpYmUoKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYXRvbS5jb21tYW5kcy5hZGQoXCJhdG9tLXdvcmtzcGFjZVwiLCB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBudWNsaWRlLWludGVybmFsL2F0b20tYXBpc1xuICAgICAgICBcImF0b20taWRlLWNvbnNvbGU6Zm9jdXMtY29uc29sZS1wcm9tcHRcIjogKCkgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLl9pbnB1dEFyZWEgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5faW5wdXRBcmVhLmZvY3VzKClcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICAgIGF0b20uY29tbWFuZHMuYWRkKFwiYXRvbS13b3Jrc3BhY2VcIiwge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbnVjbGlkZS1pbnRlcm5hbC9hdG9tLWFwaXNcbiAgICAgICAgXCJhdG9tLWlkZS1jb25zb2xlOnNjcm9sbC10by1ib3R0b21cIjogKCkgPT4ge1xuICAgICAgICAgIHRoaXMuX3Njcm9sbFRvQm90dG9tKClcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICAgYXRvbS5jb21tYW5kcy5hZGQobnVsbHRocm93cyh0aGlzLl9jb25zb2xlU2Nyb2xsUGFuZUVsKSwgXCJhdG9tLWlkZTpmaWx0ZXJcIiwgKCkgPT4gdGhpcy5fZm9jdXNGaWx0ZXIoKSlcbiAgICApXG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpOiB2b2lkIHtcbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5kaXNwb3NlKClcbiAgICB0aGlzLl9leGVjdXRvclNjb3BlRGlzcG9zYWJsZXMuZGlzcG9zZSgpXG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBQcm9wcyk6IHZvaWQge1xuICAgIC8vIElmIHJlY29yZHMgYXJlIGFkZGVkIHdoaWxlIHdlJ3JlIHNjcm9sbGVkIHRvIHRoZSBib3R0b20gKG9yIHZlcnkgdmVyeSBjbG9zZSwgYXQgbGVhc3QpLFxuICAgIC8vIGF1dG9tYXRpY2FsbHkgc2Nyb2xsLlxuICAgIGlmICh0aGlzLl9pc1Njcm9sbGVkTmVhckJvdHRvbSAmJiByZWNvcmRzQ2hhbmdlZChwcmV2UHJvcHMucmVjb3JkcywgdGhpcy5wcm9wcy5yZWNvcmRzKSkge1xuICAgICAgdGhpcy5fc3RhcnRTY3JvbGxUb0JvdHRvbSgpXG4gICAgfVxuICB9XG5cbiAgX2ZvY3VzRmlsdGVyKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9jb25zb2xlSGVhZGVyQ29tcG9uZW50ICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX2NvbnNvbGVIZWFkZXJDb21wb25lbnQuZm9jdXNGaWx0ZXIoKVxuICAgIH1cbiAgfVxuXG4gIF9yZW5kZXJQcm9tcHRCdXR0b24oKTogUmVhY3QuRWxlbWVudDxhbnk+IHtcbiAgICBpbnZhcmlhbnQodGhpcy5wcm9wcy5jdXJyZW50RXhlY3V0b3IgIT0gbnVsbClcbiAgICBjb25zdCB7IGN1cnJlbnRFeGVjdXRvciB9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IG9wdGlvbnMgPSBBcnJheS5mcm9tKHRoaXMucHJvcHMuZXhlY3V0b3JzLnZhbHVlcygpKS5tYXAoKGV4ZWN1dG9yKSA9PiAoe1xuICAgICAgaWQ6IGV4ZWN1dG9yLmlkLFxuICAgICAgbGFiZWw6IGV4ZWN1dG9yLm5hbWUsXG4gICAgfSkpXG4gICAgcmV0dXJuIChcbiAgICAgIDxQcm9tcHRCdXR0b25cbiAgICAgICAgdmFsdWU9e2N1cnJlbnRFeGVjdXRvci5pZH1cbiAgICAgICAgb25DaGFuZ2U9e3RoaXMucHJvcHMuc2VsZWN0RXhlY3V0b3J9XG4gICAgICAgIG9wdGlvbnM9e29wdGlvbnN9XG4gICAgICAgIGNoaWxkcmVuPXtjdXJyZW50RXhlY3V0b3IubmFtZX1cbiAgICAgIC8+XG4gICAgKVxuICB9XG5cbiAgX2lzU2Nyb2xsZWRUb0JvdHRvbShvZmZzZXRIZWlnaHQ6IG51bWJlciwgc2Nyb2xsSGVpZ2h0OiBudW1iZXIsIHNjcm9sbFRvcDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHNjcm9sbEhlaWdodCAtIChvZmZzZXRIZWlnaHQgKyBzY3JvbGxUb3ApIDwgNVxuICB9XG5cbiAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzOiBQcm9wcyk6IHZvaWQge1xuICAgIC8vIElmIHRoZSBtZXNzYWdlcyB3ZXJlIGNsZWFyZWQsIGhpZGUgdGhlIG5vdGlmaWNhdGlvbi5cbiAgICBpZiAobmV4dFByb3BzLnJlY29yZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLl9pc1Njcm9sbGVkTmVhckJvdHRvbSA9IHRydWVcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyB1bnNlZW5NZXNzYWdlczogZmFsc2UgfSlcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgLy8gSWYgd2UgcmVjZWl2ZSBuZXcgbWVzc2FnZXMgYWZ0ZXIgd2UndmUgc2Nyb2xsZWQgYXdheSBmcm9tIHRoZSBib3R0b20sIHNob3cgdGhlIFwibmV3XG4gICAgICAvLyBtZXNzYWdlc1wiIG5vdGlmaWNhdGlvbi5cbiAgICAgICF0aGlzLl9pc1Njcm9sbGVkTmVhckJvdHRvbSAmJlxuICAgICAgcmVjb3Jkc0NoYW5nZWQodGhpcy5wcm9wcy5yZWNvcmRzLCBuZXh0UHJvcHMucmVjb3JkcylcbiAgICApIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyB1bnNlZW5NZXNzYWdlczogdHJ1ZSB9KVxuICAgIH1cblxuICAgIHRoaXMuX2V4ZWN1dG9yU2NvcGVEaXNwb3NhYmxlcy5kaXNwb3NlKClcbiAgICB0aGlzLl9leGVjdXRvclNjb3BlRGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZSgpXG4gICAgZm9yIChjb25zdCBleGVjdXRvciBvZiBuZXh0UHJvcHMuZXhlY3V0b3JzLnZhbHVlcygpKSB7XG4gICAgICBpZiAoZXhlY3V0b3IgIT0gbnVsbCAmJiBleGVjdXRvci5vbkRpZENoYW5nZVNjb3BlTmFtZSAhPSBudWxsKSB7XG4gICAgICAgIHRoaXMuX2V4ZWN1dG9yU2NvcGVEaXNwb3NhYmxlcy5hZGQoXG4gICAgICAgICAgZXhlY3V0b3Iub25EaWRDaGFuZ2VTY29wZU5hbWUoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2NvcGVOYW1lID0gZXhlY3V0b3Iuc2NvcGVOYW1lKClcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICBzY29wZU5hbWUsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzaG91bGRDb21wb25lbnRVcGRhdGUobmV4dFByb3BzOiBQcm9wcywgbmV4dFN0YXRlOiBTdGF0ZSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhc2hhbGxvd0VxdWFsKHRoaXMucHJvcHMsIG5leHRQcm9wcykgfHwgIXNoYWxsb3dFcXVhbCh0aGlzLnN0YXRlLCBuZXh0U3RhdGUpXG4gIH1cblxuICBfZ2V0RXhlY3V0b3IgPSAoaWQ6IHN0cmluZyk6ID9FeGVjdXRvciA9PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMuZXhlY3V0b3JzLmdldChpZClcbiAgfVxuXG4gIF9nZXRQcm92aWRlciA9IChpZDogc3RyaW5nKTogP1NvdXJjZUluZm8gPT4ge1xuICAgIHJldHVybiB0aGlzLnByb3BzLmdldFByb3ZpZGVyKGlkKVxuICB9XG5cbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbnNvbGVcIj5cbiAgICAgICAgPFN0eWxlU2hlZXRcbiAgICAgICAgICBzb3VyY2VQYXRoPVwiY29uc29sZS1mb250LXN0eWxlXCJcbiAgICAgICAgICBwcmlvcml0eT17LTF9XG4gICAgICAgICAgY3NzPXtgXG4gICAgICAgICAgICAjY29uc29sZS1mb250LXNpemUtJHt0aGlzLl9pZH0ge1xuICAgICAgICAgICAgICBmb250LXNpemU6ICR7dGhpcy5wcm9wcy5mb250U2l6ZX1weDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBgfVxuICAgICAgICAvPlxuICAgICAgICA8Q29uc29sZUhlYWRlclxuICAgICAgICAgIGNsZWFyPXt0aGlzLnByb3BzLmNsZWFyUmVjb3Jkc31cbiAgICAgICAgICBjcmVhdGVQYXN0ZT17dGhpcy5wcm9wcy5jcmVhdGVQYXN0ZX1cbiAgICAgICAgICBpbnZhbGlkRmlsdGVySW5wdXQ9e3RoaXMucHJvcHMuaW52YWxpZEZpbHRlcklucHV0fVxuICAgICAgICAgIGVuYWJsZVJlZ0V4cEZpbHRlcj17dGhpcy5wcm9wcy5lbmFibGVSZWdFeHBGaWx0ZXJ9XG4gICAgICAgICAgZmlsdGVyVGV4dD17dGhpcy5wcm9wcy5maWx0ZXJUZXh0fVxuICAgICAgICAgIHJlZj17KGNvbXBvbmVudCkgPT4gKHRoaXMuX2NvbnNvbGVIZWFkZXJDb21wb25lbnQgPSBjb21wb25lbnQpfVxuICAgICAgICAgIHNlbGVjdGVkU291cmNlSWRzPXt0aGlzLnByb3BzLnNlbGVjdGVkU291cmNlSWRzfVxuICAgICAgICAgIHNvdXJjZXM9e3RoaXMucHJvcHMuc291cmNlc31cbiAgICAgICAgICBvbkZpbHRlckNoYW5nZT17dGhpcy5wcm9wcy51cGRhdGVGaWx0ZXJ9XG4gICAgICAgICAgb25TZWxlY3RlZFNvdXJjZXNDaGFuZ2U9e3RoaXMucHJvcHMuc2VsZWN0U291cmNlc31cbiAgICAgICAgICBzZWxlY3RlZFNldmVyaXRpZXM9e3RoaXMucHJvcHMuc2VsZWN0ZWRTZXZlcml0aWVzfVxuICAgICAgICAgIHRvZ2dsZVNldmVyaXR5PXt0aGlzLnByb3BzLnRvZ2dsZVNldmVyaXR5fVxuICAgICAgICAvPlxuICAgICAgICB7LypcbiAgICAgICAgICBXZSBuZWVkIGFuIGV4dHJhIHdyYXBwZXIgZWxlbWVudCBoZXJlIGluIG9yZGVyIHRvIGhhdmUgdGhlIG5ldyBtZXNzYWdlcyBub3RpZmljYXRpb24gc3RpY2tcbiAgICAgICAgICB0byB0aGUgYm90dG9tIG9mIHRoZSBzY3JvbGxhYmxlIGFyZWEgKGFuZCBub3Qgc2Nyb2xsIHdpdGggaXQpLlxuXG4gICAgICAgICAgY29uc29sZS1mb250LXNpemUgaXMgZGVmaW5lZCBpbiBtYWluLmpzIGFuZCB1cGRhdGVkIHZpYSBhIHVzZXIgc2V0dGluZ1xuICAgICAgICAqL31cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjb25zb2xlLWJvZHlcIiBpZD17XCJjb25zb2xlLWZvbnQtc2l6ZS1cIiArIHRoaXMuX2lkfT5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBjbGFzc05hbWU9XCJjb25zb2xlLXNjcm9sbC1wYW5lLXdyYXBwZXIgYXRvbS1pZGUtZmlsdGVyYWJsZVwiXG4gICAgICAgICAgICByZWY9eyhlbCkgPT4gKHRoaXMuX2NvbnNvbGVTY3JvbGxQYW5lRWwgPSBlbCl9XG4gICAgICAgICAgPlxuICAgICAgICAgICAgPEZpbHRlclJlbWluZGVyXG4gICAgICAgICAgICAgIG5vdW49XCJtZXNzYWdlXCJcbiAgICAgICAgICAgICAgbm91blBsdXJhbD1cIm1lc3NhZ2VzXCJcbiAgICAgICAgICAgICAgZmlsdGVyZWRSZWNvcmRDb3VudD17dGhpcy5wcm9wcy5maWx0ZXJlZFJlY29yZENvdW50fVxuICAgICAgICAgICAgICBvblJlc2V0PXt0aGlzLnByb3BzLnJlc2V0QWxsRmlsdGVyc31cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8T3V0cHV0VGFibGVcbiAgICAgICAgICAgICAgLy8gJEZsb3dGaXhNZSg+PTAuNTMuMCkgRmxvdyBzdXBwcmVzc1xuICAgICAgICAgICAgICByZWY9e3RoaXMuX2hhbmRsZU91dHB1dFRhYmxlfVxuICAgICAgICAgICAgICByZWNvcmRzPXt0aGlzLnByb3BzLnJlY29yZHN9XG4gICAgICAgICAgICAgIHNob3dTb3VyY2VMYWJlbHM9e3RoaXMucHJvcHMuc2VsZWN0ZWRTb3VyY2VJZHMubGVuZ3RoID4gMX1cbiAgICAgICAgICAgICAgZm9udFNpemU9e3RoaXMucHJvcHMuZm9udFNpemV9XG4gICAgICAgICAgICAgIGdldEV4ZWN1dG9yPXt0aGlzLl9nZXRFeGVjdXRvcn1cbiAgICAgICAgICAgICAgZ2V0UHJvdmlkZXI9e3RoaXMuX2dldFByb3ZpZGVyfVxuICAgICAgICAgICAgICBvblNjcm9sbD17dGhpcy5faGFuZGxlU2Nyb2xsfVxuICAgICAgICAgICAgICBzaG91bGRTY3JvbGxUb0JvdHRvbT17dGhpcy5fc2hvdWxkU2Nyb2xsVG9Cb3R0b219XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgPE5ld01lc3NhZ2VzTm90aWZpY2F0aW9uIHZpc2libGU9e3RoaXMuc3RhdGUudW5zZWVuTWVzc2FnZXN9IG9uQ2xpY2s9e3RoaXMuX3N0YXJ0U2Nyb2xsVG9Cb3R0b219IC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAge3RoaXMuX3JlbmRlclByb21wdCgpfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIClcbiAgfVxuXG4gIF9nZXRNdWx0aUxpbmVUaXAoKTogc3RyaW5nIHtcbiAgICBjb25zdCB7IGN1cnJlbnRFeGVjdXRvciB9ID0gdGhpcy5wcm9wc1xuICAgIGlmIChjdXJyZW50RXhlY3V0b3IgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIFwiXCJcbiAgICB9XG4gICAgY29uc3Qga2V5Q29tYm8gPVxuICAgICAgcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gXCJkYXJ3aW5cIlxuICAgICAgICA/IC8vIE9wdGlvbiArIEVudGVyIG9uIE1hY1xuICAgICAgICAgIFwiXFx1MjMyNSAgKyBcXHUyM0NFXCJcbiAgICAgICAgOiAvLyBTaGlmdCArIEVudGVyIG9uIFdpbmRvd3MgYW5kIExpbnV4LlxuICAgICAgICAgIFwiU2hpZnQgKyBFbnRlclwiXG5cbiAgICByZXR1cm4gYFRpcDogJHtrZXlDb21ib30gdG8gaW5zZXJ0IGEgbmV3bGluZWBcbiAgfVxuXG4gIF9yZW5kZXJQcm9tcHQoKTogP1JlYWN0LkVsZW1lbnQ8YW55PiB7XG4gICAgY29uc3QgeyBjdXJyZW50RXhlY3V0b3IgfSA9IHRoaXMucHJvcHNcbiAgICBpZiAoY3VycmVudEV4ZWN1dG9yID09IG51bGwpIHtcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJjb25zb2xlLXByb21wdFwiPlxuICAgICAgICB7dGhpcy5fcmVuZGVyUHJvbXB0QnV0dG9uKCl9XG4gICAgICAgIDxJbnB1dEFyZWFcbiAgICAgICAgICByZWY9eyhjb21wb25lbnQ6ID9JbnB1dEFyZWEpID0+ICh0aGlzLl9pbnB1dEFyZWEgPSBjb21wb25lbnQpfVxuICAgICAgICAgIHNjb3BlTmFtZT17dGhpcy5zdGF0ZS5zY29wZU5hbWV9XG4gICAgICAgICAgZm9udFNpemU9e3RoaXMucHJvcHMuZm9udFNpemV9XG4gICAgICAgICAgb25TdWJtaXQ9e3RoaXMuX2V4ZWN1dGVQcm9tcHR9XG4gICAgICAgICAgaGlzdG9yeT17dGhpcy5wcm9wcy5oaXN0b3J5fVxuICAgICAgICAgIHdhdGNoRWRpdG9yPXt0aGlzLnByb3BzLndhdGNoRWRpdG9yfVxuICAgICAgICAgIHBsYWNlaG9sZGVyVGV4dD17dGhpcy5fZ2V0TXVsdGlMaW5lVGlwKCl9XG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbiAgICApXG4gIH1cblxuICBfZXhlY3V0ZVByb21wdCA9IChjb2RlOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICB0aGlzLnByb3BzLmV4ZWN1dGUoY29kZSlcbiAgICAvLyBNYWtlcyB0aGUgY29uc29sZSB0byBzY3JvbGwgdG8gdGhlIGJvdHRvbS5cbiAgICB0aGlzLl9pc1Njcm9sbGVkTmVhckJvdHRvbSA9IHRydWVcbiAgfVxuXG4gIF9oYW5kbGVTY3JvbGwgPSAob2Zmc2V0SGVpZ2h0OiBudW1iZXIsIHNjcm9sbEhlaWdodDogbnVtYmVyLCBzY3JvbGxUb3A6IG51bWJlcik6IHZvaWQgPT4ge1xuICAgIHRoaXMuX2hhbmRsZVNjcm9sbEVuZChvZmZzZXRIZWlnaHQsIHNjcm9sbEhlaWdodCwgc2Nyb2xsVG9wKVxuICB9XG5cbiAgX2hhbmRsZVNjcm9sbEVuZChvZmZzZXRIZWlnaHQ6IG51bWJlciwgc2Nyb2xsSGVpZ2h0OiBudW1iZXIsIHNjcm9sbFRvcDogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgaXNTY3JvbGxlZFRvQm90dG9tID0gdGhpcy5faXNTY3JvbGxlZFRvQm90dG9tKG9mZnNldEhlaWdodCwgc2Nyb2xsSGVpZ2h0LCBzY3JvbGxUb3ApXG5cbiAgICB0aGlzLl9pc1Njcm9sbGVkTmVhckJvdHRvbSA9IGlzU2Nyb2xsZWRUb0JvdHRvbVxuICAgIHRoaXMuX3N0b3BTY3JvbGxUb0JvdHRvbSgpXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAvLyBUT0RPOiAod2Jpbm5zc21pdGgpIFQzMDc3MTQzNSB0aGlzIHNldFN0YXRlIGRlcGVuZHMgb24gY3VycmVudCBzdGF0ZVxuICAgICAgLy8gYW5kIHNob3VsZCB1c2UgYW4gdXBkYXRlciBmdW5jdGlvbiByYXRoZXIgdGhhbiBhbiBvYmplY3RcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9uby1hY2Nlc3Mtc3RhdGUtaW4tc2V0c3RhdGVcbiAgICAgIHVuc2Vlbk1lc3NhZ2VzOiB0aGlzLnN0YXRlLnVuc2Vlbk1lc3NhZ2VzICYmICF0aGlzLl9pc1Njcm9sbGVkTmVhckJvdHRvbSxcbiAgICB9KVxuICB9XG5cbiAgX2hhbmRsZU91dHB1dFRhYmxlID0gKHJlZjogT3V0cHV0VGFibGUpOiB2b2lkID0+IHtcbiAgICB0aGlzLl9vdXRwdXRUYWJsZSA9IHJlZlxuICB9XG5cbiAgX3Njcm9sbFRvQm90dG9tID0gKCk6IHZvaWQgPT4ge1xuICAgIGlmICghdGhpcy5fb3V0cHV0VGFibGUpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRoaXMuX291dHB1dFRhYmxlLnNjcm9sbFRvQm90dG9tKClcblxuICAgIHRoaXMuc2V0U3RhdGUoeyB1bnNlZW5NZXNzYWdlczogZmFsc2UgfSlcbiAgfVxuXG4gIF9zdGFydFNjcm9sbFRvQm90dG9tID0gKCk6IHZvaWQgPT4ge1xuICAgIGlmICghdGhpcy5fY29udGludW91c2x5U2Nyb2xsVG9Cb3R0b20pIHtcbiAgICAgIHRoaXMuX2NvbnRpbnVvdXNseVNjcm9sbFRvQm90dG9tID0gdHJ1ZVxuXG4gICAgICB0aGlzLl9zY3JvbGxpbmdUaHJvdHRsZSA9IE9ic2VydmFibGUudGltZXIoTUFYSU1VTV9TQ1JPTExJTkdfVElNRSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5fc3RvcFNjcm9sbFRvQm90dG9tKClcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgdGhpcy5fc2Nyb2xsVG9Cb3R0b20oKVxuICB9XG5cbiAgX3N0b3BTY3JvbGxUb0JvdHRvbSA9ICgpOiB2b2lkID0+IHtcbiAgICB0aGlzLl9jb250aW51b3VzbHlTY3JvbGxUb0JvdHRvbSA9IGZhbHNlXG4gICAgaWYgKHRoaXMuX3Njcm9sbGluZ1Rocm90dGxlICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX3Njcm9sbGluZ1Rocm90dGxlLnVuc3Vic2NyaWJlKClcbiAgICB9XG4gIH1cblxuICBfc2hvdWxkU2Nyb2xsVG9Cb3R0b20gPSAoKTogYm9vbGVhbiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX2lzU2Nyb2xsZWROZWFyQm90dG9tIHx8IHRoaXMuX2NvbnRpbnVvdXNseVNjcm9sbFRvQm90dG9tXG4gIH1cbn1cbiJdfQ==