"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = accumulateState;

var _immutable = require("immutable");

var _collection = require("@atom-ide-community/nuclide-commons/collection");

var Actions = _interopRequireWildcard(require("./Actions"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
const RECORD_PROPERTIES_TO_COMPARE = ['text', 'level', 'format', 'scopeName', 'sourceId', 'kind'];

function shouldAccumulateRecordCount(recordA, recordB) {
  if (String(recordA.sourceId).toLowerCase().includes('debugger') || String(recordB.sourceId).toLowerCase().includes('debugger')) {
    return false;
  } // Never merge incomplete records.


  if (recordA.incomplete || recordB.incomplete) {
    return false;
  }

  const areRelevantPropertiesEqual = RECORD_PROPERTIES_TO_COMPARE.every(prop => recordA[prop] === recordB[prop]); // if data exists, we should not accumulate this into the previous record

  const doesDataExist = recordA.expressions && recordA.expressions.length > 0 || recordB.expressions && recordB.expressions.length > 0;
  const recATags = recordA.tags;
  const recBTags = recordB.tags;
  const areTagsEqual = !recATags && !recBTags || recATags && recBTags && (0, _collection.arrayEqual)(recATags, recBTags);
  return areRelevantPropertiesEqual && !Boolean(doesDataExist) && Boolean(areTagsEqual);
}

function accumulateState(state, action) {
  switch (action.type) {
    case Actions.RECORD_RECEIVED:
      {
        const {
          record
        } = action.payload;
        let {
          records,
          incompleteRecords
        } = state;

        if (record.incomplete) {
          incompleteRecords = incompleteRecords.push(record);
        } else {
          // check if the message is exactly the same as the previous one, if so
          // we add a count to it.
          const lastRecord = records.last();

          if (lastRecord != null && shouldAccumulateRecordCount(lastRecord, record)) {
            // Update the last record. Don't use `splice()` because that's O(n)
            const updatedRecord = { ...lastRecord,
              repeatCount: lastRecord.repeatCount + 1,
              timestamp: record.timestamp
            };
            records = records.pop().push(updatedRecord);
          } else {
            records = records.push(record);
          }

          if (records.size > state.maxMessageCount) {
            // We could only have gone over by one.
            records = records.shift();
          }
        }

        return { ...state,
          records,
          incompleteRecords
        };
      }

    case Actions.RECORD_UPDATED:
      {
        let {
          records,
          incompleteRecords
        } = state;
        const {
          messageId,
          appendText,
          overrideLevel,
          setComplete
        } = action.payload;
        let found = false;

        for (let i = 0; i < incompleteRecords.size; i++) {
          const record = incompleteRecords.get(i);

          if (record != null && record.messageId === messageId) {
            // Create a replacement message object with the new properties.
            const newRecord = { ...record,
              text: appendText != null ? record.text + appendText : record.text,
              level: overrideLevel != null ? overrideLevel : record.level,
              incomplete: !setComplete
            };

            if (setComplete) {
              incompleteRecords = incompleteRecords.remove(i);
              records = records.push(newRecord);

              if (records.size > state.maxMessageCount) {
                records = records.shift();
              }
            } else {
              incompleteRecords = incompleteRecords.set(i, newRecord);
            }

            found = true;
            break;
          }
        }

        if (!found) {
          throw new Error(`Expected incomplete console message with id ${messageId} not found`);
        }

        return { ...state,
          records,
          incompleteRecords
        };
      }

    case Actions.SET_MAX_MESSAGE_COUNT:
      {
        const {
          maxMessageCount
        } = action.payload;

        if (maxMessageCount <= 0) {
          return state;
        }

        return { ...state,
          maxMessageCount,
          records: state.records.slice(-maxMessageCount)
        };
      }

    case Actions.REGISTER_SOURCE:
      {
        const {
          source
        } = action.payload;
        return { ...state,
          providers: new Map(state.providers).set(source.id, { ...source,
            name: source.name || source.id
          })
        };
      }

    case Actions.CLEAR_RECORDS:
      {
        return { ...state,
          records: (0, _immutable.List)()
        };
      }

    case Actions.REGISTER_EXECUTOR:
      {
        const {
          executor
        } = action.payload;
        return { ...state,
          executors: new Map(state.executors).set(executor.id, executor)
        };
      }

    case Actions.SELECT_EXECUTOR:
      {
        const {
          executorId
        } = action.payload;
        return { ...state,
          currentExecutorId: executorId
        };
      }

    case Actions.REMOVE_SOURCE:
      {
        const {
          sourceId
        } = action.payload;
        const providers = new Map(state.providers);
        const providerStatuses = new Map(state.providerStatuses);
        const executors = new Map(state.executors);
        providers.delete(sourceId);
        providerStatuses.delete(sourceId);
        executors.delete(sourceId);
        return { ...state,
          providers,
          providerStatuses,
          executors
        };
      }

    case Actions.UPDATE_STATUS:
      {
        const {
          status,
          providerId
        } = action.payload;
        return { ...state,
          providerStatuses: new Map(state.providerStatuses).set(providerId, status)
        };
      }

    case Actions.EXECUTE:
      {
        const command = action.payload.code;
        const newHistory = state.history[state.history.length - 1] === command ? state.history : state.history.concat(command);
        return { ...state,
          history: newHistory.slice(-1000)
        };
      }

    case Actions.SET_CREATE_PASTE_FUNCTION:
      {
        const {
          createPasteFunction
        } = action.payload;
        return { ...state,
          createPasteFunction
        };
      }

    case Actions.SET_WATCH_EDITOR_FUNCTION:
      {
        const {
          watchEditor
        } = action.payload;
        return { ...state,
          watchEditor
        };
      }

    case Actions.SET_FONT_SIZE:
      {
        const {
          fontSize
        } = action.payload;
        return { ...state,
          fontSize
        };
      }
  }

  return state;
}

module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJlZHVjZXJzLmpzIl0sIm5hbWVzIjpbIlJFQ09SRF9QUk9QRVJUSUVTX1RPX0NPTVBBUkUiLCJzaG91bGRBY2N1bXVsYXRlUmVjb3JkQ291bnQiLCJyZWNvcmRBIiwicmVjb3JkQiIsIlN0cmluZyIsInNvdXJjZUlkIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImluY29tcGxldGUiLCJhcmVSZWxldmFudFByb3BlcnRpZXNFcXVhbCIsImV2ZXJ5IiwicHJvcCIsImRvZXNEYXRhRXhpc3QiLCJleHByZXNzaW9ucyIsImxlbmd0aCIsInJlY0FUYWdzIiwidGFncyIsInJlY0JUYWdzIiwiYXJlVGFnc0VxdWFsIiwiQm9vbGVhbiIsImFjY3VtdWxhdGVTdGF0ZSIsInN0YXRlIiwiYWN0aW9uIiwidHlwZSIsIkFjdGlvbnMiLCJSRUNPUkRfUkVDRUlWRUQiLCJyZWNvcmQiLCJwYXlsb2FkIiwicmVjb3JkcyIsImluY29tcGxldGVSZWNvcmRzIiwicHVzaCIsImxhc3RSZWNvcmQiLCJsYXN0IiwidXBkYXRlZFJlY29yZCIsInJlcGVhdENvdW50IiwidGltZXN0YW1wIiwicG9wIiwic2l6ZSIsIm1heE1lc3NhZ2VDb3VudCIsInNoaWZ0IiwiUkVDT1JEX1VQREFURUQiLCJtZXNzYWdlSWQiLCJhcHBlbmRUZXh0Iiwib3ZlcnJpZGVMZXZlbCIsInNldENvbXBsZXRlIiwiZm91bmQiLCJpIiwiZ2V0IiwibmV3UmVjb3JkIiwidGV4dCIsImxldmVsIiwicmVtb3ZlIiwic2V0IiwiRXJyb3IiLCJTRVRfTUFYX01FU1NBR0VfQ09VTlQiLCJzbGljZSIsIlJFR0lTVEVSX1NPVVJDRSIsInNvdXJjZSIsInByb3ZpZGVycyIsIk1hcCIsImlkIiwibmFtZSIsIkNMRUFSX1JFQ09SRFMiLCJSRUdJU1RFUl9FWEVDVVRPUiIsImV4ZWN1dG9yIiwiZXhlY3V0b3JzIiwiU0VMRUNUX0VYRUNVVE9SIiwiZXhlY3V0b3JJZCIsImN1cnJlbnRFeGVjdXRvcklkIiwiUkVNT1ZFX1NPVVJDRSIsInByb3ZpZGVyU3RhdHVzZXMiLCJkZWxldGUiLCJVUERBVEVfU1RBVFVTIiwic3RhdHVzIiwicHJvdmlkZXJJZCIsIkVYRUNVVEUiLCJjb21tYW5kIiwiY29kZSIsIm5ld0hpc3RvcnkiLCJoaXN0b3J5IiwiY29uY2F0IiwiU0VUX0NSRUFURV9QQVNURV9GVU5DVElPTiIsImNyZWF0ZVBhc3RlRnVuY3Rpb24iLCJTRVRfV0FUQ0hfRURJVE9SX0ZVTkNUSU9OIiwid2F0Y2hFZGl0b3IiLCJTRVRfRk9OVF9TSVpFIiwiZm9udFNpemUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFjQTs7QUFDQTs7QUFDQTs7Ozs7O0FBaEJBOzs7Ozs7Ozs7OztBQWtCQSxNQUFNQSw0QkFBNEIsR0FBRyxDQUNuQyxNQURtQyxFQUVuQyxPQUZtQyxFQUduQyxRQUhtQyxFQUluQyxXQUptQyxFQUtuQyxVQUxtQyxFQU1uQyxNQU5tQyxDQUFyQzs7QUFTQSxTQUFTQywyQkFBVCxDQUNFQyxPQURGLEVBRUVDLE9BRkYsRUFHVztBQUNULE1BQ0VDLE1BQU0sQ0FBQ0YsT0FBTyxDQUFDRyxRQUFULENBQU4sQ0FDR0MsV0FESCxHQUVHQyxRQUZILENBRVksVUFGWixLQUdBSCxNQUFNLENBQUNELE9BQU8sQ0FBQ0UsUUFBVCxDQUFOLENBQ0dDLFdBREgsR0FFR0MsUUFGSCxDQUVZLFVBRlosQ0FKRixFQU9FO0FBQ0EsV0FBTyxLQUFQO0FBQ0QsR0FWUSxDQVlUOzs7QUFDQSxNQUFJTCxPQUFPLENBQUNNLFVBQVIsSUFBc0JMLE9BQU8sQ0FBQ0ssVUFBbEMsRUFBOEM7QUFDNUMsV0FBTyxLQUFQO0FBQ0Q7O0FBRUQsUUFBTUMsMEJBQTBCLEdBQUdULDRCQUE0QixDQUFDVSxLQUE3QixDQUNqQ0MsSUFBSSxJQUFJVCxPQUFPLENBQUNTLElBQUQsQ0FBUCxLQUFrQlIsT0FBTyxDQUFDUSxJQUFELENBREEsQ0FBbkMsQ0FqQlMsQ0FxQlQ7O0FBQ0EsUUFBTUMsYUFBYSxHQUNoQlYsT0FBTyxDQUFDVyxXQUFSLElBQXVCWCxPQUFP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QUEvQjtBQUNBLGNBQU1DLFVBQVUsR0FDZHpELEtBQUssQ0FBQzBELE9BQU4sQ0FBYzFELEtBQUssQ0FBQzBELE9BQU4sQ0FBY2pFLE1BQWQsR0FBdUIsQ0FBckMsTUFBNEM4RCxPQUE1QyxHQUNJdkQsS0FBSyxDQUFDMEQsT0FEVixHQUVJMUQsS0FBSyxDQUFDMEQsT0FBTixDQUFjQyxNQUFkLENBQXFCSixPQUFyQixDQUhOO0FBSUEsZUFBTyxFQUNMLEdBQUd2RCxLQURFO0FBRUwwRCxVQUFBQSxPQUFPLEVBQUVELFVBQVUsQ0FBQ3ZCLEtBQVgsQ0FBaUIsQ0FBQyxJQUFsQjtBQUZKLFNBQVA7QUFJRDs7QUFDRCxTQUFLL0IsT0FBTyxDQUFDeUQseUJBQWI7QUFBd0M7QUFDdEMsY0FBTTtBQUFDQyxVQUFBQTtBQUFELFlBQXdCNUQsTUFBTSxDQUFDSyxPQUFyQztBQUNBLGVBQU8sRUFDTCxHQUFHTixLQURFO0FBRUw2RCxVQUFBQTtBQUZLLFNBQVA7QUFJRDs7QUFDRCxTQUFLMUQsT0FBTyxDQUFDMkQseUJBQWI7QUFBd0M7QUFDdEMsY0FBTTtBQUFDQyxVQUFBQTtBQUFELFlBQWdCOUQsTUFBTSxDQUFDSyxPQUE3QjtBQUNBLGVBQU8sRUFDTCxHQUFHTixLQURFO0FBRUwrRCxVQUFBQTtBQUZLLFNBQVA7QUFJRDs7QUFDRCxTQUFLNUQsT0FBTyxDQUFDNkQsYUFBYjtBQUE0QjtBQUMxQixjQUFNO0FBQUNDLFVBQUFBO0FBQUQsWUFBYWhFLE1BQU0sQ0FBQ0ssT0FBMUI7QUFDQSxlQUFPLEVBQ0wsR0FBR04sS0FERTtBQUVMaUUsVUFBQUE7QUFGSyxTQUFQO0FBSUQ7QUF2TEg7O0FBMExBLFNBQU9qRSxLQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQGZsb3cgc3RyaWN0LWxvY2FsXG4gKiBAZm9ybWF0XG4gKi9cblxuaW1wb3J0IHR5cGUge0FjdGlvbiwgQXBwU3RhdGUsIFJlY29yZH0gZnJvbSAnLi4vdHlwZXMnO1xuXG5pbXBvcnQge0xpc3R9IGZyb20gJ2ltbXV0YWJsZSc7XG5pbXBvcnQge2FycmF5RXF1YWx9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL2NvbGxlY3Rpb24nO1xuaW1wb3J0ICogYXMgQWN0aW9ucyBmcm9tICcuL0FjdGlvbnMnO1xuXG5jb25zdCBSRUNPUkRfUFJPUEVSVElFU19UT19DT01QQVJFID0gW1xuICAndGV4dCcsXG4gICdsZXZlbCcsXG4gICdmb3JtYXQnLFxuICAnc2NvcGVOYW1lJyxcbiAgJ3NvdXJjZUlkJyxcbiAgJ2tpbmQnLFxuXTtcblxuZnVuY3Rpb24gc2hvdWxkQWNjdW11bGF0ZVJlY29yZENvdW50KFxuICByZWNvcmRBOiBSZWNvcmQsXG4gIHJlY29yZEI6IFJlY29yZCxcbik6IGJvb2xlYW4ge1xuICBpZiAoXG4gICAgU3RyaW5nKHJlY29yZEEuc291cmNlSWQpXG4gICAgICAudG9Mb3dlckNhc2UoKVxuICAgICAgLmluY2x1ZGVzKCdkZWJ1Z2dlcicpIHx8XG4gICAgU3RyaW5nKHJlY29yZEIuc291cmNlSWQpXG4gICAgICAudG9Mb3dlckNhc2UoKVxuICAgICAgLmluY2x1ZGVzKCdkZWJ1Z2dlcicpXG4gICkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIE5ldmVyIG1lcmdlIGluY29tcGxldGUgcmVjb3Jkcy5cbiAgaWYgKHJlY29yZEEuaW5jb21wbGV0ZSB8fCByZWNvcmRCLmluY29tcGxldGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBhcmVSZWxldmFudFByb3BlcnRpZXNFcXVhbCA9IFJFQ09SRF9QUk9QRVJUSUVTX1RPX0NPTVBBUkUuZXZlcnkoXG4gICAgcHJvcCA9PiByZWNvcmRBW3Byb3BdID09PSByZWNvcmRCW3Byb3BdLFxuICApO1xuXG4gIC8vIGlmIGRhdGEgZXhpc3RzLCB3ZSBzaG91bGQgbm90IGFjY3VtdWxhdGUgdGhpcyBpbnRvIHRoZSBwcmV2aW91cyByZWNvcmRcbiAgY29uc3QgZG9lc0RhdGFFeGlzdCA9XG4gICAgKHJlY29yZEEuZXhwcmVzc2lvbnMgJiYgcmVjb3JkQS5leHByZXNzaW9ucy5sZW5ndGggPiAwKSB8fFxuICAgIChyZWNvcmRCLmV4cHJlc3Npb25zICYmIHJlY29yZEIuZXhwcmVzc2lvbnMubGVuZ3RoID4gMCk7XG5cbiAgY29uc3QgcmVjQVRhZ3MgPSByZWNvcmRBLnRhZ3M7XG4gIGNvbnN0IHJlY0JUYWdzID0gcmVjb3JkQi50YWdzO1xuICBjb25zdCBhcmVUYWdzRXF1YWwgPVxuICAgICghcmVjQVRhZ3MgJiYgIXJlY0JUYWdzKSB8fFxuICAgIChyZWNBVGFncyAmJiByZWNCVGFncyAmJiBhcnJheUVxdWFsKHJlY0FUYWdzLCByZWNCVGFncykpO1xuXG4gIHJldHVybiAoXG4gICAgYXJlUmVsZXZhbnRQcm9wZXJ0aWVzRXF1YWwgJiZcbiAgICAhQm9vbGVhbihkb2VzRGF0YUV4aXN0KSAmJlxuICAgIEJvb2xlYW4oYXJlVGFnc0VxdWFsKVxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBhY2N1bXVsYXRlU3RhdGUoXG4gIHN0YXRlOiBBcHBTdGF0ZSxcbiAgYWN0aW9uOiBBY3Rpb24sXG4pOiBBcHBTdGF0ZSB7XG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlIEFjdGlvbnMuUkVDT1JEX1JFQ0VJVkVEOiB7XG4gICAgICBjb25zdCB7cmVjb3JkfSA9IGFjdGlvbi5wYXlsb2FkO1xuICAgICAgbGV0IHtyZWNvcmRzLCBpbmNvbXBsZXRlUmVjb3Jkc30gPSBzdGF0ZTtcblxuICAgICAgaWYgKHJlY29yZC5pbmNvbXBsZXRlKSB7XG4gICAgICAgIGluY29tcGxldGVSZWNvcmRzID0gaW5jb21wbGV0ZVJlY29yZHMucHVzaChyZWNvcmQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIG1lc3NhZ2UgaXMgZXhhY3RseSB0aGUgc2FtZSBhcyB0aGUgcHJldmlvdXMgb25lLCBpZiBzb1xuICAgICAgICAvLyB3ZSBhZGQgYSBjb3VudCB0byBpdC5cbiAgICAgICAgY29uc3QgbGFzdFJlY29yZCA9IHJlY29yZHMubGFzdCgpO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgbGFzdFJlY29yZCAhPSBudWxsICYmXG4gICAgICAgICAgc2hvdWxkQWNjdW11bGF0ZVJlY29yZENvdW50KGxhc3RSZWNvcmQsIHJlY29yZClcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gVXBkYXRlIHRoZSBsYXN0IHJlY29yZC4gRG9uJ3QgdXNlIGBzcGxpY2UoKWAgYmVjYXVzZSB0aGF0J3MgTyhuKVxuICAgICAgICAgIGNvbnN0IHVwZGF0ZWRSZWNvcmQ6IFJlY29yZCA9IHtcbiAgICAgICAgICAgIC4uLmxhc3RSZWNvcmQsXG4gICAgICAgICAgICByZXBlYXRDb3VudDogbGFzdFJlY29yZC5yZXBlYXRDb3VudCArIDEsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHJlY29yZC50aW1lc3RhbXAsXG4gICAgICAgICAgfTtcbiAgICAgICAgICByZWNvcmRzID0gcmVjb3Jkcy5wb3AoKS5wdXNoKHVwZGF0ZWRSZWNvcmQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlY29yZHMgPSByZWNvcmRzLnB1c2gocmVjb3JkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZWNvcmRzLnNpemUgPiBzdGF0ZS5tYXhNZXNzYWdlQ291bnQpIHtcbiAgICAgICAgICAvLyBXZSBjb3VsZCBvbmx5IGhhdmUgZ29uZSBvdmVyIGJ5IG9uZS5cbiAgICAgICAgICByZWNvcmRzID0gcmVjb3Jkcy5zaGlmdCgpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICByZWNvcmRzLFxuICAgICAgICBpbmNvbXBsZXRlUmVjb3JkcyxcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgQWN0aW9ucy5SRUNPUkRfVVBEQVRFRDoge1xuICAgICAgbGV0IHtyZWNvcmRzLCBpbmNvbXBsZXRlUmVjb3Jkc30gPSBzdGF0ZTtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgICBhcHBlbmRUZXh0LFxuICAgICAgICBvdmVycmlkZUxldmVsLFxuICAgICAgICBzZXRDb21wbGV0ZSxcbiAgICAgIH0gPSBhY3Rpb24ucGF5bG9hZDtcblxuICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluY29tcGxldGVSZWNvcmRzLnNpemU7IGkrKykge1xuICAgICAgICBjb25zdCByZWNvcmQgPSBpbmNvbXBsZXRlUmVjb3Jkcy5nZXQoaSk7XG4gICAgICAgIGlmIChyZWNvcmQgIT0gbnVsbCAmJiByZWNvcmQubWVzc2FnZUlkID09PSBtZXNzYWdlSWQpIHtcbiAgICAgICAgICAvLyBDcmVhdGUgYSByZXBsYWNlbWVudCBtZXNzYWdlIG9iamVjdCB3aXRoIHRoZSBuZXcgcHJvcGVydGllcy5cbiAgICAgICAgICBjb25zdCBuZXdSZWNvcmQgPSB7XG4gICAgICAgICAgICAuLi5yZWNvcmQsXG4gICAgICAgICAgICB0ZXh0OiBhcHBlbmRUZXh0ICE9IG51bGwgPyByZWNvcmQudGV4dCArIGFwcGVuZFRleHQgOiByZWNvcmQudGV4dCxcbiAgICAgICAgICAgIGxldmVsOiBvdmVycmlkZUxldmVsICE9IG51bGwgPyBvdmVycmlkZUxldmVsIDogcmVjb3JkLmxldmVsLFxuICAgICAgICAgICAgaW5jb21wbGV0ZTogIXNldENvbXBsZXRlLFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBpZiAoc2V0Q29tcGxldGUpIHtcbiAgICAgICAgICAgIGluY29tcGxldGVSZWNvcmRzID0gaW5jb21wbGV0ZVJlY29yZHMucmVtb3ZlKGkpO1xuICAgICAgICAgICAgcmVjb3JkcyA9IHJlY29yZHMucHVzaChuZXdSZWNvcmQpO1xuICAgICAgICAgICAgaWYgKHJlY29yZHMuc2l6ZSA+IHN0YXRlLm1heE1lc3NhZ2VDb3VudCkge1xuICAgICAgICAgICAgICByZWNvcmRzID0gcmVjb3Jkcy5zaGlmdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbmNvbXBsZXRlUmVjb3JkcyA9IGluY29tcGxldGVSZWNvcmRzLnNldChpLCBuZXdSZWNvcmQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIWZvdW5kKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgRXhwZWN0ZWQgaW5jb21wbGV0ZSBjb25zb2xlIG1lc3NhZ2Ugd2l0aCBpZCAke21lc3NhZ2VJZH0gbm90IGZvdW5kYCxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIHJlY29yZHMsXG4gICAgICAgIGluY29tcGxldGVSZWNvcmRzLFxuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBBY3Rpb25zLlNFVF9NQVhfTUVTU0FHRV9DT1VOVDoge1xuICAgICAgY29uc3Qge21heE1lc3NhZ2VDb3VudH0gPSBhY3Rpb24ucGF5bG9hZDtcbiAgICAgIGlmIChtYXhNZXNzYWdlQ291bnQgPD0gMCkge1xuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgbWF4TWVzc2FnZUNvdW50LFxuICAgICAgICByZWNvcmRzOiBzdGF0ZS5yZWNvcmRzLnNsaWNlKC1tYXhNZXNzYWdlQ291bnQpLFxuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBBY3Rpb25zLlJFR0lTVEVSX1NPVVJDRToge1xuICAgICAgY29uc3Qge3NvdXJjZX0gPSBhY3Rpb24ucGF5bG9hZDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICBwcm92aWRlcnM6IG5ldyBNYXAoc3RhdGUucHJvdmlkZXJzKS5zZXQoc291cmNlLmlkLCB7XG4gICAgICAgICAgLi4uc291cmNlLFxuICAgICAgICAgIG5hbWU6IHNvdXJjZS5uYW1lIHx8IHNvdXJjZS5pZCxcbiAgICAgICAgfSksXG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIEFjdGlvbnMuQ0xFQVJfUkVDT1JEUzoge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIHJlY29yZHM6IExpc3QoKSxcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgQWN0aW9ucy5SRUdJU1RFUl9FWEVDVVRPUjoge1xuICAgICAgY29uc3Qge2V4ZWN1dG9yfSA9IGFjdGlvbi5wYXlsb2FkO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIGV4ZWN1dG9yczogbmV3IE1hcChzdGF0ZS5leGVjdXRvcnMpLnNldChleGVjdXRvci5pZCwgZXhlY3V0b3IpLFxuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBBY3Rpb25zLlNFTEVDVF9FWEVDVVRPUjoge1xuICAgICAgY29uc3Qge2V4ZWN1dG9ySWR9ID0gYWN0aW9uLnBheWxvYWQ7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgY3VycmVudEV4ZWN1dG9ySWQ6IGV4ZWN1dG9ySWQsXG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIEFjdGlvbnMuUkVNT1ZFX1NPVVJDRToge1xuICAgICAgY29uc3Qge3NvdXJjZUlkfSA9IGFjdGlvbi5wYXlsb2FkO1xuICAgICAgY29uc3QgcHJvdmlkZXJzID0gbmV3IE1hcChzdGF0ZS5wcm92aWRlcnMpO1xuICAgICAgY29uc3QgcHJvdmlkZXJTdGF0dXNlcyA9IG5ldyBNYXAoc3RhdGUucHJvdmlkZXJTdGF0dXNlcyk7XG4gICAgICBjb25zdCBleGVjdXRvcnMgPSBuZXcgTWFwKHN0YXRlLmV4ZWN1dG9ycyk7XG4gICAgICBwcm92aWRlcnMuZGVsZXRlKHNvdXJjZUlkKTtcbiAgICAgIHByb3ZpZGVyU3RhdHVzZXMuZGVsZXRlKHNvdXJjZUlkKTtcbiAgICAgIGV4ZWN1dG9ycy5kZWxldGUoc291cmNlSWQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIHByb3ZpZGVycyxcbiAgICAgICAgcHJvdmlkZXJTdGF0dXNlcyxcbiAgICAgICAgZXhlY3V0b3JzLFxuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBBY3Rpb25zLlVQREFURV9TVEFUVVM6IHtcbiAgICAgIGNvbnN0IHtzdGF0dXMsIHByb3ZpZGVySWR9ID0gYWN0aW9uLnBheWxvYWQ7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgcHJvdmlkZXJTdGF0dXNlczogbmV3IE1hcChzdGF0ZS5wcm92aWRlclN0YXR1c2VzKS5zZXQoXG4gICAgICAgICAgcHJvdmlkZXJJZCxcbiAgICAgICAgICBzdGF0dXMsXG4gICAgICAgICksXG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIEFjdGlvbnMuRVhFQ1VURToge1xuICAgICAgY29uc3QgY29tbWFuZCA9IGFjdGlvbi5wYXlsb2FkLmNvZGU7XG4gICAgICBjb25zdCBuZXdIaXN0b3J5ID1cbiAgICAgICAgc3RhdGUuaGlzdG9yeVtzdGF0ZS5oaXN0b3J5Lmxlbmd0aCAtIDFdID09PSBjb21tYW5kXG4gICAgICAgICAgPyBzdGF0ZS5oaXN0b3J5XG4gICAgICAgICAgOiBzdGF0ZS5oaXN0b3J5LmNvbmNhdChjb21tYW5kKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICBoaXN0b3J5OiBuZXdIaXN0b3J5LnNsaWNlKC0xMDAwKSxcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgQWN0aW9ucy5TRVRfQ1JFQVRFX1BBU1RFX0ZVTkNUSU9OOiB7XG4gICAgICBjb25zdCB7Y3JlYXRlUGFzdGVGdW5jdGlvbn0gPSBhY3Rpb24ucGF5bG9hZDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICBjcmVhdGVQYXN0ZUZ1bmN0aW9uLFxuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBBY3Rpb25zLlNFVF9XQVRDSF9FRElUT1JfRlVOQ1RJT046IHtcbiAgICAgIGNvbnN0IHt3YXRjaEVkaXRvcn0gPSBhY3Rpb24ucGF5bG9hZDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICB3YXRjaEVkaXRvcixcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgQWN0aW9ucy5TRVRfRk9OVF9TSVpFOiB7XG4gICAgICBjb25zdCB7Zm9udFNpemV9ID0gYWN0aW9uLnBheWxvYWQ7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgZm9udFNpemUsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBzdGF0ZTtcbn1cbiJdfQ==